"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5683],{55477:(E,M,r)=>{r.d(M,{d:()=>l});var _=r(69808),b=r(93075),t=r(23349),g=r(51062),e=r(5e3);let l=(()=>{class f{}return f.\u0275fac=function(y){return new(y||f)},f.\u0275mod=e.oAB({type:f}),f.\u0275inj=e.cJS({imports:[[_.ez,b.u5,b.UX,g.aw.forChild(),t.Pc]]}),f})()},94229:(E,M,r)=>{r.d(M,{G:()=>C});var _=r(70655),b=r(49926),t=r(5e3),g=r(51062),e=r(23349),l=r(69808);const f=["radioGroup"],P=["search"];function y(u,v){if(1&u&&(t.TgZ(0,"ion-item"),t.TgZ(1,"ion-grid"),t.TgZ(2,"ion-row"),t.TgZ(3,"ion-col",15),t.TgZ(4,"div",16),t._UZ(5,"span"),t._uU(6),t.qZA(),t.qZA(),t.TgZ(7,"ion-col",17),t._uU(8),t.qZA(),t.qZA(),t.TgZ(9,"ion-row"),t.TgZ(10,"ion-col",18),t._UZ(11,"ion-img",19),t.qZA(),t.TgZ(12,"ion-col",20),t._uU(13),t.qZA(),t.qZA(),t.TgZ(14,"ion-row",21),t.TgZ(15,"ion-col",22),t._uU(16," **** "),t.qZA(),t.TgZ(17,"ion-col",22),t._uU(18," **** "),t.qZA(),t.TgZ(19,"ion-col",22),t._uU(20," **** "),t.qZA(),t.TgZ(21,"ion-col",22),t._uU(22),t.qZA(),t.qZA(),t.TgZ(23,"ion-row"),t.TgZ(24,"ion-col",23),t._uU(25),t.qZA(),t.TgZ(26,"ion-col",17),t._uU(27),t.qZA(),t.qZA(),t.qZA(),t._UZ(28,"ion-radio",24),t.qZA()),2&u){const i=v.$implicit,o=t.oxw();t.xp6(1),t.ekj("cardON","Activo"),t.xp6(4),t.ekj("ON","Activo"==i.estado)("OFF","Inactivo"==i.estado),t.xp6(1),t.hij(" ",i.estado," "),t.xp6(2),t.hij(" ",i.banco," "),t.xp6(5),t.hij(" ",i.nombre," "),t.xp6(9),t.hij(" ",o.padLeadingZeros(o.authenticationService.decryptvalue(i.n4))," "),t.xp6(3),t.AsE(" Expira: ",i.mes," / ",i.ano," "),t.xp6(2),t.hij(" ",i.tipo," "),t.xp6(1),t.Q6J("value",i._id)}}let C=(()=>{class u{constructor(i,o,c,d){this.translateService=i,this.modalController=o,this.authenticationService=c,this.navParams=d,this.title="AGM project",this.items2=[],this.moneda="Q",this.msg="",this.userinfo=[],this.items=[],this.defaultSelectedRadio="efectivo",this.userinfo=this.authenticationService.getcopiauser(),this.passcode="",this.finalPin="",this.mypinseguro=this.userinfo[0].codpersonal,this.message=!0,this.pageStatus="Enter Pin",this.int=0,this.newPincount=0,this.fingerPin=!1}padLeadingZeros(i,o){let c=i+"";for(;c.length<o;)c="0"+c;return c}ngOnInit(){this.tituloxx=this.navParams.get("title"),this.metodopago=this.navParams.get("metodopago"),this.userinfo=this.authenticationService.getcopiauser(),this.moneda=this.navParams.get("moneda"),this.translateService.get("SEGUROM").subscribe(i=>{this.seguro=i}),this.translateService.get("MSGM").subscribe(i=>{this.msg=i}),this.authenticationService.getReg(this.userinfo[0]._id+"/personadispid/"+this.userinfo[0].idempresa._id,"personals",0).then(i=>{this.saldoactual=i[0].saldo},i=>{this.authenticationService.presentAlert(i.error,"Precauci\xf3n","")}),this.pideregistros("Activo")}ngAfterViewInit(){setTimeout(()=>{this.selectTwo()},400)}pagar(){this.modalController.dismiss({data:this.metodopago,item:this.tpagoid})}closeModal(){return(0,_.mG)(this,void 0,void 0,function*(){this.modalController.dismiss({data:"close"})})}selectTwo(){this.radioGroup.value="efectivo"}pideregistros(i){this.itemsList=[],this.authenticationService.getReg("todos/"+i+"/"+this.userinfo[0].idempresa._id+"/"+this.userinfo[0]._id,"tarjetacreditos",0).then(o=>{this.items=o,this.itemsList=this.items},o=>{this.authenticationService.presentAlert(o.error,this.msg,"")})}radioSelect(i){this.tpagoid=i.detail.value}}return u.\u0275fac=function(i){return new(i||u)(t.Y36(g.sK),t.Y36(e.IN),t.Y36(b.$),t.Y36(e.X1))},u.\u0275cmp=t.Xpm({type:u,selectors:[["app-my-modalcredito"]],viewQuery:function(i,o){if(1&i&&(t.Gf(f,5),t.Gf(P,5)),2&i){let c;t.iGM(c=t.CRH())&&(o.radioGroup=c.first),t.iGM(c=t.CRH())&&(o.searchElementRef=c.first)}},decls:31,vars:8,consts:[[3,"translucent"],["color","primary"],["collapse","true","slot","end"],[3,"click"],["slot","icon-only","name","close"],["size","small"],[1,"ion-padding",3,"fullscreen"],[1,"ion-text-wrap"],["size","12"],["value","efectivo"],["allow-empty-selection","true","name","radio-group",3,"ionChange"],["radioGroup",""],["slot","start","color","success","value","efectivo"],[4,"ngFor","ngForOf"],["expand","block","color","primary",3,"click"],[1,"state"],[1,"msg"],[1,"bank"],["size","2",1,"chip"],["src","assets/img/chip.png"],["size","10",1,"number3"],[1,"digits"],[1,"number"],[1,"date"],["slot","start","color","success",3,"value"]],template:function(i,o){1&i&&(t.TgZ(0,"ion-header",0),t.TgZ(1,"ion-toolbar",1),t.TgZ(2,"ion-buttons",2),t.TgZ(3,"ion-button",3),t.NdJ("click",function(){return o.closeModal()}),t._UZ(4,"ion-icon",4),t.qZA(),t.qZA(),t.TgZ(5,"ion-title",5),t._uU(6),t.qZA(),t.qZA(),t.qZA(),t.TgZ(7,"ion-content",6),t.TgZ(8,"ion-item-divider",1),t.TgZ(9,"ion-label",7),t._uU(10," Canal de pago "),t.qZA(),t.qZA(),t.TgZ(11,"ion-item-divider",1),t.TgZ(12,"ion-label",8),t.TgZ(13,"h1"),t._uU(14,"Saldo actual: "),t.TgZ(15,"strong"),t._uU(16),t.ALo(17,"currency"),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(18,"ion-list"),t.TgZ(19,"ion-radio-group",9),t.TgZ(20,"div"),t.TgZ(21,"ion-radio-group",10,11),t.NdJ("ionChange",function(d){return o.radioSelect(d)}),t.TgZ(23,"ion-item"),t.TgZ(24,"ion-label",7),t.TgZ(25,"strong"),t._uU(26,"Saldo actual"),t.qZA(),t.qZA(),t._UZ(27,"ion-radio",12),t.qZA(),t.YNc(28,y,29,14,"ion-item",13),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(29,"ion-button",14),t.NdJ("click",function(){return o.pagar()}),t._uU(30," PAGAR "),t.qZA(),t.qZA()),2&i&&(t.Q6J("translucent",!0),t.xp6(6),t.Oqu(o.tituloxx),t.xp6(1),t.Q6J("fullscreen",!0),t.xp6(9),t.hij(" ",t.xi3(17,5,o.saldoactual,o.moneda),""),t.xp6(12),t.Q6J("ngForOf",o.items))},directives:[e.Gu,e.sr,e.Sm,e.YG,e.gu,e.wd,e.W2,e.rH,e.Q$,e.q_,e.se,e.QI,e.Ie,e.B7,e.U5,l.sg,e.jY,e.Nd,e.wI,e.Xz],pipes:[l.H9],styles:[".book-search-input[_ngcontent-%COMP%]{padding:6px;background:0 0;transition:top .5s ease;background:#bdbaba;border-bottom:1px solid rgba(0,0,0,.07);border-top:1px solid rgba(0,0,0,.07);margin-bottom:10px;margin-top:-1px;color:#fff;width:100%}ion-header[_ngcontent-%COMP%]{background:#4caf50}ion-title[_ngcontent-%COMP%]{text-align:center}ion-grid.cardON2[_ngcontent-%COMP%]{background-color:#606163;border-radius:10px;padding:10px;margin-bottom:15px;max-width:400px!important}ion-grid.cardON2[_ngcontent-%COMP%]   .msg[_ngcontent-%COMP%]{background-color:#414142}ion-grid.cardON[_ngcontent-%COMP%]{background-color:#4284ff;border-radius:10px;padding:10px;margin-bottom:15px;max-width:400px!important}ion-grid.cardON[_ngcontent-%COMP%]   .msg[_ngcontent-%COMP%]{background-color:#679cff}ion-grid.cardOFF[_ngcontent-%COMP%]{background-color:#bbb7b7;border-radius:10px;padding:10px;margin-bottom:15px;max-width:400px!important}ion-grid.cardOFF[_ngcontent-%COMP%]   .msg[_ngcontent-%COMP%]{background-color:#d4d4d4}.msg[_ngcontent-%COMP%]{float:left;padding:5px 8px;font-size:.8em;color:#fff;border-radius:5px}.number[_ngcontent-%COMP%]{color:#fff;font-size:1.5em;line-height:2em;text-align:center}.digits[_ngcontent-%COMP%]{padding-right:5%;padding-left:5%}.date[_ngcontent-%COMP%]{color:#fff;font-size:.8em}.bank[_ngcontent-%COMP%]{text-align:right;color:#fff;font-size:.8em}.ON[_ngcontent-%COMP%]{height:8px;width:8px;background-color:#8de278;border-radius:50%;display:inline-block;margin-right:2px}.OFF[_ngcontent-%COMP%]{height:8px;width:8px;background-color:#fb5f5f;border-radius:50%;display:inline-block;margin-right:2px}.brand[_ngcontent-%COMP%]{max-width:40%;float:right}.chip[_ngcontent-%COMP%]   ion-img[_ngcontent-%COMP%]{max-width:50px;padding-top:5%;border-radius:10%!important;overflow:hidden}ion-icon#power[_ngcontent-%COMP%]{font-size:2em}"]}),u})()},96793:(E,M,r)=>{r.d(M,{u:()=>C});var _=r(70655),b=r(49926),t=r(5e3),g=r(23349),e=r(69808),l=r(98246);function f(u,v){if(1&u&&(t.TgZ(0,"h3",12),t._uU(1,"Monto a pagar: "),t.TgZ(2,"strong"),t._uU(3),t.ALo(4,"currency"),t.qZA(),t.qZA()),2&u){const i=t.oxw();t.xp6(3),t.hij(" ",t.xi3(4,1,i.monto,i.moneda),"")}}function P(u,v){if(1&u){const i=t.EpF();t.TgZ(0,"ion-button",13),t.NdJ("click",function(){return t.CHM(i),t.oxw().Transferiri()}),t._uU(1," Transferencia "),t.qZA()}}function y(u,v){if(1&u){const i=t.EpF();t.TgZ(0,"ion-fab",14),t.TgZ(1,"ion-fab-button",15),t.NdJ("click",function(){return t.CHM(i),t.oxw().StartTimer()}),t._UZ(2,"ion-icon",16),t.qZA(),t.qZA()}}let C=(()=>{class u{constructor(i,o,c,d){this.alertController=i,this.modalController=o,this.authenticationService=c,this.navParams=d,this.qrData="",this.scannedCode=null,this.elementType="canvas",this.userinfo=[],this.countdownNumberEl=document.getElementById("countdown-number"),this.countdown=10}generaqr(){let i="";"cobrapagoqr"===this.tipo&&(i=this.userinfo[0].idempresa._id+"\xb0"+this.userinfo[0]._id+"\xb0"+this.userinfo[0].nombre+"<br> en la ubicaci\xf3n:"+this.userinfo[0].idempresa.direccion+"\xb0"+this.keyacceso+"\xb0"+this.monto),"pagoqr"===this.tipo&&(i=this.userinfo[0].idempresa._id+"\xb0"+this.userinfo[0]._id+"\xb0"+this.userinfo[0].nombre+"\xb0"+this.keyacceso+"\xb0"+this.monto),"comprasaldo"===this.tipo&&(i=this.userinfo[0].idempresa._id+"\xb0"+this.userinfo[0]._id+"\xb0"+this.userinfo[0].nombre+"\xb0"+this.keyacceso+"\xb0"+this.monto),"trasferencia"===this.tipo&&(i=this.userinfo[0].idempresa._id+"\xb0"+this.userinfo[0]._id+"\xb0"+this.userinfo[0].nombre+"\xb0"+this.keyacceso+"\xb0"+this.monto+"\xb0"+this.userntrasferencia);const o={idempresa:this.userinfo[0].idempresa._id,trama:this.authenticationService.encryptvalue(i),estado:0,tipo:this.tipo,monto:this.monto,usertrasferencia:this.usertrasferencia,bitacora:{idempresa:this.userinfo[0].idempresa._id,idafiliado:"",email:this.userinfo[0].email,permiso:"Crea",accion:"Generetoken compra"},idsuscriptor2:{id:this.userinfo[0]._id,nombre:this.userinfo[0].nombre}};this.authenticationService.createReg("",o,"compratokens").then(c=>{let d=[];d=c,this.tokenactual=d._id,"trasferencia"===this.tipo?this.qrData=this.authenticationService.encryptvalue(i+"\xb0"+this.tipo+"\xb0"+d._id+"\xb0"+this.tipo+"\xb0"+this.usertrasferencia):(this.qrData=this.authenticationService.encryptvalue(i+"\xb0"+this.tipo+"\xb0"+d._id+"\xb0"+this.tipo),this.StartTimer())})}Transferiri(){const o=document.querySelector("canvas").toDataURL("image/jpeg").toString();this.modalController.dismiss({data:this.qrData,img:o})}ngOnInit(){this.tituloxx=this.navParams.get("title"),this.moneda=this.navParams.get("moneda"),this.monto=this.navParams.get("monto"),this.tipo=this.navParams.get("tipo"),this.usertrasferencia=this.navParams.get("usertrasferencia"),this.userntrasferencia=this.navParams.get("userntrasferencia"),this.userinfo=this.authenticationService.getcopiauser(),this.keyacceso=this.userinfo[0].controlacceso,""===this.keyacceso?this.authenticationService.getReg(this.userinfo[0]._id+"/keyunica/"+this.userinfo[0]._id,"personals",0).then(i=>{let o=[];o=i,this.keyacceso=o.code,this.generaqr()}):this.generaqr()}seguroacepta(i,o){return(0,_.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({message:o,buttons:[{text:"No Aceptar",cssClass:"secondary",handler:d=>{}},{text:"Aceptar",handler:()=>{const d={estado:3,cobroservicio:this.userinfo[0].nombre+" ha  Autorizada el cobro de "+this.moneda+" "+this.monto,bitacora:{idempresa:this.userinfo[0].idempresa._id,idafiliado:"",usertrasferencia:this.usertrasferencia,email:this.userinfo[0].email,permiso:"Actualiza",accion:"acepta token "+this.tokenactual}};d&&this.authenticationService.createReg(this.tokenactual,d,"compratokens").then(A=>{this.modalController.dismiss("ok")},A=>{this.authenticationService.presentAlert(A.error,"Precauci\xf3n","")})}}]})).present()})}StartTimer(){this.timer=setTimeout(i=>{this.authenticationService.getReg(this.tokenactual+"/2","compratokens",0).then(o=>{let c=[];c=o,c.length>0?2===o[0].estado?this.seguroacepta(c[0].cobroservicio,c[0].cobroservicio):10===o[0].estado||33===o[0].estado?this.authenticationService.presentAlert(o[0].cobroservicio,"Precauci\xf3n",""):50===o[0].estado?(this.authenticationService.presentAlert(o[0].cobroservicio,"Gracias por tu pago",""),this.closeModal()):20===o[0].estado?this.authenticationService.presentAlert(o[0].cobroservicio,"Gracias por tu compra",""):this.StartTimer():this.StartTimer()},o=>{this.authenticationService.presentAlert("Transacci\xf3n insegura","Precauci\xf3n","")})},3e3)}pideverificar(){return(0,_.mG)(this,void 0,void 0,function*(){this.authenticationService.getReg(this.tokenactual+"/5","compratokens",0).then(i=>{let o=[];o=i},i=>{this.authenticationService.presentAlert("Transacci\xf3n insegura","Precauci\xf3n","")})})}closeModal(){return(0,_.mG)(this,void 0,void 0,function*(){this.modalController.dismiss({data:"close"})})}}return u.\u0275fac=function(i){return new(i||u)(t.Y36(g.Br),t.Y36(g.IN),t.Y36(b.$),t.Y36(g.X1))},u.\u0275cmp=t.Xpm({type:u,selectors:[["app-my-modalpay"]],decls:13,vars:8,consts:[[3,"translucent"],["color","primary"],["collapse","true","slot","end"],[3,"click"],["slot","icon-only","name","close"],["size","small"],[1,"ion-padding",3,"fullscreen"],["align","center"],["class","detail-title",4,"ngIf"],["width","300","height","300","qrc-colorDark","#ff0000","qrc-colorLight","#0000ff",3,"elementType","value"],["class","double-width","color","warning",3,"click",4,"ngIf"],["title","Verifica cobro","horizontal","start","vertical","bottom","slot","fixed",4,"ngIf"],[1,"detail-title"],["color","warning",1,"double-width",3,"click"],["title","Verifica cobro","horizontal","start","vertical","bottom","slot","fixed"],["color","tw_botton1",3,"click"],["color","light","name","checkmark-done-circle-outline"]],template:function(i,o){1&i&&(t.TgZ(0,"ion-header",0),t.TgZ(1,"ion-toolbar",1),t.TgZ(2,"ion-buttons",2),t.TgZ(3,"ion-button",3),t.NdJ("click",function(){return o.closeModal()}),t._UZ(4,"ion-icon",4),t.qZA(),t.qZA(),t.TgZ(5,"ion-title",5),t._uU(6),t.qZA(),t.qZA(),t.qZA(),t.TgZ(7,"ion-content",6),t.TgZ(8,"div",7),t.YNc(9,f,5,4,"h3",8),t._UZ(10,"ngx-qrcode",9),t.qZA(),t.YNc(11,P,2,0,"ion-button",10),t.YNc(12,y,3,0,"ion-fab",11),t.qZA()),2&i&&(t.Q6J("translucent",!0),t.xp6(6),t.Oqu(o.tituloxx),t.xp6(1),t.Q6J("fullscreen",!0),t.xp6(2),t.Q6J("ngIf",!1),t.xp6(1),t.Q6J("elementType",o.elementType)("value",o.qrData),t.xp6(1),t.Q6J("ngIf","trasferencia"===o.tipo),t.xp6(1),t.Q6J("ngIf","pagoqr"===o.tipo))},directives:[g.Gu,g.sr,g.Sm,g.YG,g.gu,g.wd,g.W2,e.O5,l.zF,g.IJ,g.W4],pipes:[e.H9],styles:[".book-search-input[_ngcontent-%COMP%]{padding:6px;background:0 0;transition:top .5s ease;background:#bdbaba;border-bottom:1px solid rgba(0,0,0,.07);border-top:1px solid rgba(0,0,0,.07);margin-bottom:10px;margin-top:-1px;color:#fff;width:100%}.center[_ngcontent-%COMP%]{margin-left:auto;margin-right:auto;display:block}#countdown[_ngcontent-%COMP%]{position:relative;margin:100px auto auto;height:40px;width:40px;text-align:center}#countdown-number[_ngcontent-%COMP%]{color:#fff;display:inline-block;line-height:40px}svg[_ngcontent-%COMP%]{position:absolute;top:0;right:0;width:40px;height:40px;transform:rotateY(-180deg) rotate(-90deg)}svg[_ngcontent-%COMP%]   circle[_ngcontent-%COMP%]{stroke-dasharray:113px;stroke-dashoffset:0px;stroke-linecap:round;stroke-width:2px;stroke:#fff;fill:none;-webkit-animation:countdown 10s linear infinite forwards;animation:countdown 10s linear infinite forwards}@-webkit-keyframes countdown{0%{stroke-dashoffset:0px}to{stroke-dashoffset:113px}}@keyframes countdown{0%{stroke-dashoffset:0px}to{stroke-dashoffset:113px}}.detail-title[_ngcontent-%COMP%]{font-size:22px;font-weight:500;color:var(--ion-color-dark-tint);margin:0;margin-bottom:calc(var(--page-margin) / 2)}"]}),u})()},81773:(E,M,r)=>{r.d(M,{X:()=>e});var _=r(69808),b=r(93075),t=r(23349),g=r(5e3);let e=(()=>{class l{}return l.\u0275fac=function(P){return new(P||l)},l.\u0275mod=g.oAB({type:l}),l.\u0275inj=g.cJS({imports:[[_.ez,b.u5,b.UX,t.Pc]]}),l})()},15604:(E,M,r)=>{r.d(M,{O:()=>c});var _=r(70655),b=r(49926),t=r(40872),g=r.n(t),e=r(5e3),l=r(23349),f=r(69808);const P=["video"],y=["canvas"],C=["fileinput"],u=["search"];function v(d,A){if(1&d){const n=e.EpF();e.TgZ(0,"ion-button",20),e.NdJ("click",function(){return e.CHM(n),e.oxw().stopScan()}),e._UZ(1,"ion-icon",21),e.qZA()}}function i(d,A){if(1&d){const n=e.EpF();e.TgZ(0,"ion-button",22),e.NdJ("click",function(){return e.CHM(n),e.oxw().reset()}),e._UZ(1,"ion-icon",23),e.qZA()}}function o(d,A){if(1&d&&(e.TgZ(0,"h3",24),e._uU(1,"Monto a cobrar: "),e.TgZ(2,"strong"),e._uU(3),e.ALo(4,"currency"),e.qZA(),e.qZA()),2&d){const n=e.oxw();e.xp6(3),e.hij(" ",e.xi3(4,1,n.monto,n.moneda),"")}}let c=(()=>{class d{constructor(n,s,a,p,m,h,T,Z){this.alertController=n,this.modalController=s,this.loadingCtrl=a,this.toastCtrl=p,this.authenticationService=m,this.ngZone=h,this.navParams=T,this.plt=Z,this.scanActive=!1,this.scanResult=null,this.loading=null,this.title="AGM project",this.zoom=16,this.userinfo=[],this.monto=0,this.plt.is("ios")&&"standalone"in window.navigator&&window}dismissModal(){this.modalController.dismiss({data:"close"})}ngOnInit(){this.userinfo=this.authenticationService.getcopiauser(),this.tituloxx=this.navParams.get("title"),this.moneda=this.navParams.get("moneda"),this.monto=this.navParams.get("monto"),this.tipo=this.navParams.get("tipo")}ngAfterViewInit(){this.canvasElement=this.canvas.nativeElement,this.canvasContext=this.canvasElement.getContext("2d"),this.videoElement=this.video.nativeElement,this.startScan()}showQrToast(){return(0,_.mG)(this,void 0,void 0,function*(){(yield this.toastCtrl.create({message:`Open ${this.scanResult}?`,position:"top",buttons:[{text:"Open",handler:()=>{window.open(this.scanResult,"_system","location=yes")}}]})).present()})}reset(){this.scanResult=null}stopScan(){this.scanActive=!1}startScan(){return(0,_.mG)(this,void 0,void 0,function*(){const n=yield navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});this.videoElement.srcObject=n,this.videoElement.setAttribute("playsinline",!0),this.loading=yield this.loadingCtrl.create({}),yield this.loading.present(),this.videoElement.play(),requestAnimationFrame(this.scan.bind(this))})}scan(){return(0,_.mG)(this,void 0,void 0,function*(){if(this.videoElement.readyState===this.videoElement.HAVE_ENOUGH_DATA){this.loading&&(yield this.loading.dismiss(),this.loading=null,this.scanActive=!0),this.canvasElement.height=this.videoElement.videoHeight,this.canvasElement.width=this.videoElement.videoWidth,this.canvasContext.drawImage(this.videoElement,0,0,this.canvasElement.width,this.canvasElement.height);const n=this.canvasContext.getImageData(0,0,this.canvasElement.width,this.canvasElement.height),s=g()(n.data,n.width,n.height,{inversionAttempts:"dontInvert"});if(s){this.scanActive=!1,this.scanResult=this.authenticationService.decryptvalue(s.data);const a=this.scanResult.split("\xb0");this.tokenactual=a[6],"pagoqr"===this.tipo?this.verificapago(a):this.cobronormal(a)}else this.scanActive&&requestAnimationFrame(this.scan.bind(this))}else requestAnimationFrame(this.scan.bind(this))})}captureImage(){this.fileinput.nativeElement.click()}handleFile(n){const s=n.item(0),a=new Image;a.onload=()=>{this.canvasContext.drawImage(a,0,0,this.canvasElement.width,this.canvasElement.height);const p=this.canvasContext.getImageData(0,0,this.canvasElement.width,this.canvasElement.height),m=g()(p.data,p.width,p.height,{inversionAttempts:"dontInvert"});if(m){this.scanResult=this.authenticationService.decryptvalue(m.data);const h=this.scanResult.split("\xb0");this.tokenactual=h[6],"cobrapagoqr"===this.tipo?this.cobronormalreves(h):"pagoqr"===this.tipo?this.verificapago(h):this.cobronormal(h)}},a.src=URL.createObjectURL(s)}verificapago(n){this.authenticationService.getReg(this.tokenactual+"/3","compratokens",0).then(s=>{let a=[];a=s,a.length>0?3===s[0].estado?this.cobronormalsinsaldo(n):0===s[0].estado?this.authenticationService.getReg(n[1]+"/personadispid/"+n[0],"personals",0).then(p=>{if(Number(p[0].saldo)>=Number(this.monto)){const m={estado:2,cobroservicio:this.userinfo[0].idempresa.nombre+"<br> en la ubicaci\xf3n:"+this.userinfo[0].idempresa.direccion+"<br> Quiere cobrar "+this.moneda+" "+this.monto+"<br> \xbf Desea autorizar la transaccion?",bitacora:{idempresa:this.userinfo[0].idempresa._id,idafiliado:"",email:this.userinfo[0].email,permiso:"Actualiza",accion:"acepta token "+this.tokenactual}};m&&this.authenticationService.createReg(this.tokenactual,m,"compratokens").then(h=>{this.StartTimer(n)},h=>{this.authenticationService.presentAlert(h.error,"Precauci\xf3n","")})}else{const m={estado:10,cobroservicio:"Fondos insuficientes",bitacora:{idempresa:this.userinfo[0].idempresa._id,idafiliado:"",email:this.userinfo[0].email,permiso:"Actualiza",accion:"acepta token "+this.tokenactual}};m&&this.authenticationService.createReg(this.tokenactual,m,"compratokens").then(h=>{this.authenticationService.presentAlert("Fondos insuficientes","Precauci\xf3n","")},h=>{this.authenticationService.presentAlert(h.error,"Precauci\xf3n","")})}},p=>{this.authenticationService.presentAlert(p.error,"Precauci\xf3n","")}):this.StartTimer(n):this.authenticationService.presentAlert("Transacci\xf3n insegura","Precauci\xf3n","")},s=>{this.authenticationService.presentAlert("Transacci\xf3n insegura","Precauci\xf3n","")})}StartTimer(n){this.timer=setTimeout(s=>{this.authenticationService.getReg(this.tokenactual+"/3","compratokens",0).then(a=>{let p=[];p=a,p.length>0&&3===a[0].estado?this.cobronormalsinsaldo(n):this.StartTimer(n)},a=>{this.authenticationService.presentAlert("Transacci\xf3n insegura","Precauci\xf3n","")})},3e3)}closeModal(){return(0,_.mG)(this,void 0,void 0,function*(){this.modalController.dismiss({data:"close"})})}cobronormal(n){this.authenticationService.getReg(n[6]+"/2","compratokens",0).then(s=>{let a=[];if(a=s,a.length>0)if(0===s[0].estado)if(this.authenticationService.decryptvalue(a[0].trama)+"\xb0"+a[0]._id+"\xb0"+a[0].tipo===this.scanResult)if(this.monto===n[4]){const m={operacion:"pagaservicio",dservicio:"Cobro por pago de servicio",cservicio:"Cobro por servicio",nodispositivo:"servicio",noprov:"",idempresa:this.userinfo[0].idempresa._id,idsuscriptor:n[1],tipocompra:"servicio",tokencompra:a[0]._id,nombre:n[2],monto:this.monto,url:"",tpago:"Efectivo",estado:"Facturado",bitacora:{idempresa:this.userinfo[0].idempresa._id,idafiliado:"",email:this.userinfo[0].email,permiso:"Crea",accion:"Compra de saldo"},idempresa0:n[1],idsuscriptor2:{id:this.userinfo[0]._id,nombre:this.userinfo[0].nombre}};m&&this.authenticationService.createReg("",m,"comprasaldos").then(h=>{this.modalController.dismiss({data:"Se ha realizado una venta a: "+n[2]+"<br> Por un monto de "+this.moneda+" "+this.monto})},h=>{this.authenticationService.presentAlert(h.error,"Precauci\xf3n","")})}else this.authenticationService.presentAlert("El Monto no coincide con lo que el cliente programo.<br> El cliente quiere comprar: "+this.moneda+" "+n[4]+"<br> Se quiere acreditar: "+this.moneda+" "+this.monto,"Precauci\xf3n","");else this.authenticationService.presentAlert("Transacci\xf3n insegura","Precauci\xf3n","");else this.authenticationService.presentAlert("Transacci\xf3n insegura","Precauci\xf3n","");else this.authenticationService.presentAlert("Transacci\xf3n insegura","Precauci\xf3n","")})}seguroacepta(n,s,a){return(0,_.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({message:n,buttons:[{text:"No Aceptar",cssClass:"secondary",handler:m=>{const h={estado:33,cobroservicio:"Cliente no autorizo transaccion ",bitacora:{idempresa:this.userinfo[0].idempresa._id,idafiliado:"",email:this.userinfo[0].email,permiso:"Actualiza",accion:"acepta token "+this.tokenactual}};h&&this.authenticationService.createReg(this.tokenactual,h,"compratokens").then(T=>{this.modalController.dismiss("ok")},T=>{this.authenticationService.presentAlert(T.error,"Precauci\xf3n","")})}},{text:"Aceptar",handler:()=>{var m=s[2].split("<");const h={operacion:"pagaservicio",dservicio:"Cobro por pago de servicio",cservicio:"Cobro por servicio",nodispositivo:"servicio",noprov:"",idempresa:s[0],idsuscriptor:this.userinfo[0]._id,tipocompra:"servicio",tokencompra:a[0]._id,nombre:this.userinfo[0].nombre,monto:s[4],url:"",tpago:"Efectivo",estado:"Facturado",bitacora:{idempresa:s[0],idafiliado:"",email:this.userinfo[0].email,permiso:"Crea",accion:"Cobro por pago de servicio"},idempresa0:this.userinfo[0]._id,idsuscriptor2:{id:s[1],nombre:m[0]}};h&&this.authenticationService.createReg("",h,"comprasaldos").then(T=>{const Z={estado:33,cobroservicio:"Cobro realizado con exito ",bitacora:{idempresa:this.userinfo[0].idempresa._id,idafiliado:"",email:this.userinfo[0].email,permiso:"Actualiza",accion:"acepta token "+this.tokenactual}};Z&&this.authenticationService.createReg(this.tokenactual,Z,"compratokens").then(x=>{this.modalController.dismiss("ok")},x=>{this.authenticationService.presentAlert(x.error,"Precauci\xf3n","")})},T=>{const Z={estado:33,cobroservicio:"Cliente no autorizo transaccion ",bitacora:{idempresa:this.userinfo[0].idempresa._id,idafiliado:"",email:this.userinfo[0].email,permiso:"Actualiza",accion:"acepta token "+this.tokenactual}};Z&&this.authenticationService.createReg(this.tokenactual,Z,"compratokens").then(x=>{this.modalController.dismiss("ok")},x=>{this.authenticationService.presentAlert(x.error,"Precauci\xf3n","")}),this.authenticationService.presentAlert(T.error,"Precauci\xf3n","")})}}]})).present()})}cobronormalreves(n){this.authenticationService.getReg(n[6]+"/2","compratokens",0).then(s=>{let a=[];a=s,a.length>0&&0===s[0].estado&&this.authenticationService.decryptvalue(a[0].trama)+"\xb0"+a[0].tipo+"\xb0"+a[0]._id+"\xb0"+a[0].tipo===this.scanResult?this.seguroacepta(n[2]+"<br> Quiere cobrar "+this.moneda+" "+n[4]+"<br> \xbf Desea autorizar la transaccion?",n,a):this.authenticationService.presentAlert("Transacci\xf3n insegura","Precauci\xf3n","")})}cobronormalsinsaldo(n){this.authenticationService.getReg(n[1]+"/personadispid/"+n[0],"personals",0).then(s=>{if(Number(s[0].saldo)>=Number(this.monto))this.authenticationService.getReg(n[6]+"/2","compratokens",0).then(a=>{let p=[];p=a;const m={operacion:"pagaservicio",dservicio:"Cobro por pago de servicio",cservicio:"Cobro por servicio",nodispositivo:"servicio",noprov:"",idempresa:this.userinfo[0].idempresa._id,idsuscriptor:n[1],tipocompra:"servicio",tokencompra:p[0]._id,nombre:n[2],monto:this.monto,url:"",tpago:"Efectivo",estado:"Facturado",bitacora:{idempresa:this.userinfo[0].idempresa._id,idafiliado:"",email:this.userinfo[0].email,permiso:"Crea",accion:"Compra de saldo"},idempresa0:n[1],idsuscriptor2:{id:this.userinfo[0]._id,nombre:this.userinfo[0].nombre}};m&&this.authenticationService.createReg("",m,"comprasaldos").then(h=>{this.modalController.dismiss({data:"Se ha realizado una venta a: "+n[2]+"<br> Por un monto de "+this.moneda+" "+this.monto})},h=>{this.authenticationService.presentAlert(h.error,"Precauci\xf3n","")})},a=>{this.authenticationService.presentAlert("Transacci\xf3n insegura","Precauci\xf3n","")});else{const a={estado:100,cobroservicio:"Fondos insuficientes, transaccion anulada",bitacora:{idempresa:this.userinfo[0].idempresa._id,idafiliado:"",email:this.userinfo[0].email,permiso:"Actualiza",accion:"acepta token "+this.tokenactual}};a&&this.authenticationService.createReg(this.tokenactual,a,"compratokens").then(p=>{this.authenticationService.presentAlert("Fondos insuficientes, transaccion anulada","Precauci\xf3n","")},p=>{this.authenticationService.presentAlert(p.error,"Precauci\xf3n","")})}})}}return d.\u0275fac=function(n){return new(n||d)(e.Y36(l.Br),e.Y36(l.IN),e.Y36(l.HT),e.Y36(l.yF),e.Y36(b.$),e.Y36(e.R0b),e.Y36(l.X1),e.Y36(l.t4))},d.\u0275cmp=e.Xpm({type:d,selectors:[["app-my-modalscanpay"]],viewQuery:function(n,s){if(1&n&&(e.Gf(P,5),e.Gf(y,5),e.Gf(C,5),e.Gf(u,5)),2&n){let a;e.iGM(a=e.CRH())&&(s.video=a.first),e.iGM(a=e.CRH())&&(s.canvas=a.first),e.iGM(a=e.CRH())&&(s.fileinput=a.first),e.iGM(a=e.CRH())&&(s.searchElementRef=a.first)}},decls:22,vars:7,consts:[[3,"translucent"],["color","primary"],["collapse","true","slot","end"],["title","Parar escaner","color","danger",3,"click",4,"ngIf"],["title","Reset","color","warning",3,"click",4,"ngIf"],["title","Iniciar escaner",3,"click"],["slot","icon-only","name","qr-code-outline"],["title","leer imagen qr de galeria",3,"click"],["slot","icon-only","name","image-outline"],[3,"click"],["slot","icon-only","name","close"],["size","small"],[1,"ion-padding",3,"fullscreen"],["type","file","accept","image/*;capture=camera","hidden","",3,"change"],["fileinput",""],["class","detail-title",4,"ngIf"],["width","100%",3,"hidden"],["video",""],["hidden",""],["canvas",""],["title","Parar escaner","color","danger",3,"click"],["slot","start","name","stop-circle-outline"],["title","Reset","color","warning",3,"click"],["slot","start","name","refresh-circle-outline"],[1,"detail-title"]],template:function(n,s){1&n&&(e.TgZ(0,"ion-header",0),e.TgZ(1,"ion-toolbar",1),e.TgZ(2,"ion-buttons",2),e.YNc(3,v,2,0,"ion-button",3),e.YNc(4,i,2,0,"ion-button",4),e.TgZ(5,"ion-button",5),e.NdJ("click",function(){return s.startScan()}),e._UZ(6,"ion-icon",6),e.qZA(),e.TgZ(7,"ion-button",7),e.NdJ("click",function(){return s.captureImage()}),e._UZ(8,"ion-icon",8),e.qZA(),e.TgZ(9,"ion-button",9),e.NdJ("click",function(){return s.closeModal()}),e._UZ(10,"ion-icon",10),e.qZA(),e.qZA(),e.TgZ(11,"ion-title",11),e._uU(12),e.qZA(),e.qZA(),e.qZA(),e.TgZ(13,"ion-content",12),e.TgZ(14,"input",13,14),e.NdJ("change",function(p){return s.handleFile(p.target.files)}),e.qZA(),e._UZ(16,"br"),e.YNc(17,o,5,4,"h3",15),e._UZ(18,"video",16,17),e._UZ(20,"canvas",18,19),e.qZA()),2&n&&(e.Q6J("translucent",!0),e.xp6(3),e.Q6J("ngIf",s.scanActive),e.xp6(1),e.Q6J("ngIf",s.scanResult),e.xp6(8),e.Oqu(s.tituloxx),e.xp6(1),e.Q6J("fullscreen",!0),e.xp6(4),e.Q6J("ngIf",0!==s.monto),e.xp6(1),e.Q6J("hidden",!s.scanActive))},directives:[l.Gu,l.sr,l.Sm,f.O5,l.YG,l.gu,l.wd,l.W2],pipes:[f.H9],styles:["[_nghost-%COMP%]{--page-margin: var(--app-fair-margin);--page-background: var(--app-background);--page-swiper-pagination-space: 30px;--page-swiper-pagination-height: 18px;--page-pagination-bullet-size: 10px;--page-options-gutter: calc(var(--page-margin) / 2);--page-related-items-gutter: calc(var(--page-margin) / 2);--page-color: #089bdf}.book-search-input[_ngcontent-%COMP%]{padding:6px;background:0 0;transition:top .5s ease;background:#bdbaba;border-bottom:1px solid rgba(0,0,0,.07);border-top:1px solid rgba(0,0,0,.07);margin-bottom:10px;margin-top:-1px;color:#fff;width:100%}.detail-title[_ngcontent-%COMP%]{font-size:22px;font-weight:500;color:var(--ion-color-dark-tint);margin:0;margin-bottom:calc(var(--page-margin) / 2)}"]}),d})()}}]);