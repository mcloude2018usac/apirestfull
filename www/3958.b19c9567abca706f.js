"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3958],{79764:(D,N,x)=>{x.r(N),x.d(N,{formulariomovilsproceso2CreatePageModule:()=>vt});var S=x(23349),k=x(55787),T=x(69808),O=x(33678),E=x(51062),j=x(93075),M=x(36351),w=x(76398),z=x(81656),v=x(70655),U=x(68554),F=x(63814),R=x(15190),L=x(26388),t=x(5e3);function G(h,_){if(1&h){const e=t.EpF();t.TgZ(0,"ion-item",1),t.NdJ("click",function(){return t.CHM(e),t.oxw().close("Agregar Comentarios")}),t.TgZ(1,"ion-label",3),t._uU(2,"Agregar Comentarios"),t.qZA(),t.qZA()}}function J(h,_){if(1&h){const e=t.EpF();t.TgZ(0,"ion-item",1),t.NdJ("click",function(){return t.CHM(e),t.oxw().close("Agregar Archivos")}),t.TgZ(1,"ion-label",3),t._uU(2,"Agregar Fotos"),t.qZA(),t.qZA()}}function Y(h,_){if(1&h){const e=t.EpF();t.TgZ(0,"ion-item",1),t.NdJ("click",function(){return t.CHM(e),t.oxw().close("Agregar Documentos")}),t.TgZ(1,"ion-label",3),t._uU(2,"Agregar Documentos"),t.qZA(),t.qZA()}}function B(h,_){if(1&h){const e=t.EpF();t.TgZ(0,"ion-item",1),t.NdJ("click",function(){return t.CHM(e),t.oxw().close("Asignar Tareas segun proceso")}),t.TgZ(1,"ion-label",2),t._uU(2,"Asignar Tareas segun proceso"),t.qZA(),t.qZA()}}function Q(h,_){if(1&h){const e=t.EpF();t.TgZ(0,"ion-item",1),t.NdJ("click",function(){return t.CHM(e),t.oxw().close("Documentaci\xf3n de orden")}),t.TgZ(1,"ion-label",2),t._uU(2,"Documentaci\xf3n de orden"),t.qZA(),t.qZA()}}function K(h,_){if(1&h){const e=t.EpF();t.TgZ(0,"ion-item",1),t.NdJ("click",function(){return t.CHM(e),t.oxw().close("Otras opciones")}),t.TgZ(1,"ion-label",2),t._uU(2,"Otras opciones"),t.qZA(),t.qZA()}}let V=(()=>{class h{constructor(e,a){this.popoverCtrl=e,this.navParams=a,this.permisosorden=[],this.permisosorden=a.get("permisosorden"),this.estadointerno=a.get("estadointerno"),this.otras=a.get("otras")}support(){this.popoverCtrl.dismiss()}close(e){this.popoverCtrl.dismiss({data:e})}}return h.\u0275fac=function(e){return new(e||h)(t.Y36(S.Dh),t.Y36(S.X1))},h.\u0275cmp=t.Xpm({type:h,selectors:[["ng-component"]],decls:10,vars:6,consts:[["button","",3,"click",4,"ngIf"],["button","",3,"click"],["text-wrap","",1,"ion-text-wrap"],[1,"ion-text-wrap"]],template:function(e,a){1&e&&(t.TgZ(0,"ion-list"),t.YNc(1,G,3,0,"ion-item",0),t.YNc(2,J,3,0,"ion-item",0),t.YNc(3,Y,3,0,"ion-item",0),t.YNc(4,B,3,0,"ion-item",0),t.TgZ(5,"ion-item",1),t.NdJ("click",function(){return a.close("Estados del proceso")}),t.TgZ(6,"ion-label",2),t._uU(7,"Estados del proceso"),t.qZA(),t.qZA(),t.YNc(8,Q,3,0,"ion-item",0),t.YNc(9,K,3,0,"ion-item",0),t.qZA()),2&e&&(t.xp6(1),t.Q6J("ngIf","true"===a.permisosorden.comentariosorden||"sololectura"===a.estadointerno),t.xp6(1),t.Q6J("ngIf","true"===a.permisosorden.fotosorden||"sololectura"===a.estadointerno),t.xp6(1),t.Q6J("ngIf","true"===a.permisosorden.documentosorden||"sololectura"===a.estadointerno),t.xp6(1),t.Q6J("ngIf","true"===a.permisosorden.tareasorden&&"sololectura"!==a.estadointerno),t.xp6(4),t.Q6J("ngIf","true"===a.permisosorden.documentacionorden&&"sololectura"!==a.estadointerno),t.xp6(1),t.Q6J("ngIf","true"===a.otras&&"sololectura"!==a.estadointerno))},directives:[S.q_,T.O5,S.Ie,S.Q$],encapsulation:2}),h})();var W=x(21295),H=x(59978),X=x(21113);const $=["inputId"],tt=["fotoa"];function it(h,_){if(1&h){const e=t.EpF();t.TgZ(0,"ion-button",8),t.NdJ("click",function(){return t.CHM(e),t.oxw().comandoscmd()}),t.ALo(1,"translate"),t._UZ(2,"ion-icon",28),t.qZA()}2&h&&t.MGl("title"," ",t.lcZ(1,1,"ejecutar_comandos"),"")}function et(h,_){if(1&h){const e=t.EpF();t.TgZ(0,"ion-button",8),t.NdJ("click",function(){return t.CHM(e),t.oxw().grabar("")}),t.ALo(1,"translate"),t._UZ(2,"ion-icon",29),t.qZA()}2&h&&t.MGl("title"," ",t.lcZ(1,1,"grabar_info"),"")}function at(h,_){if(1&h){const e=t.EpF();t.TgZ(0,"ion-button",8),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return i.printpdf(i.dataitem)}),t.ALo(1,"translate"),t._UZ(2,"ion-icon",30),t.qZA()}2&h&&t.s9C("title",t.lcZ(1,1,"imprimir_pdf"))}function ot(h,_){if(1&h){const e=t.EpF();t.TgZ(0,"ion-button",8),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return i.printa(i.dataitem)}),t.ALo(1,"translate"),t._UZ(2,"ion-icon",30),t.qZA()}2&h&&t.MGl("title"," ",t.lcZ(1,1,"imprimir"),"")}function rt(h,_){if(1&h){const e=t.EpF();t.TgZ(0,"ion-button",8),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return i.printexcel(i.dataitem)}),t.ALo(1,"translate"),t._UZ(2,"ion-icon",31),t.qZA()}2&h&&t.MGl("title"," ",t.lcZ(1,1,"imprimir_excel"),"")}function st(h,_){if(1&h){const e=t.EpF();t.TgZ(0,"ion-button",8),t.NdJ("click",function(i){return t.CHM(e),t.oxw().trayectoria(i)}),t.ALo(1,"translate"),t._UZ(2,"ion-icon",32),t.qZA()}2&h&&t.MGl("title"," ",t.lcZ(1,1,"trayectoria0"),"")}function nt(h,_){if(1&h&&(t.TgZ(0,"a",33),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&h){const e=t.oxw();t.MGl("href","https://www.google.com/maps/search/?api=1&query=",e.dataitem.geoposicionxxx.replace("\xac",","),"",t.LSH),t.xp6(1),t.AsE(" ",t.lcZ(2,3,"geo"),": ",e.dataitem.geoposicionxxx.replace("\xac",","),"")}}function ct(h,_){if(1&h&&(t.TgZ(0,"ion-label",20),t._uU(1),t.qZA()),2&h){const e=t.oxw();t.xp6(1),t.Oqu(e.dataitem.estadointerno)}}function lt(h,_){if(1&h&&(t.TgZ(0,"ion-label",34),t._uU(1),t.qZA()),2&h){const e=t.oxw();t.xp6(1),t.Oqu(e.dataitem.estadointerno)}}function dt(h,_){if(1&h&&(t.TgZ(0,"h2"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&h){const e=t.oxw();t.xp6(1),t.lnq(" ",t.lcZ(2,3,"actividad"),": ",e.dataitem.actividadxxx,"- (",e.dataitem.sequenciag,") ")}}function ut(h,_){if(1&h&&(t.TgZ(0,"h2"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&h){const e=t.oxw();t.xp6(1),t.lnq(" ",t.lcZ(2,3,"actividad"),": ",e.dataitem.actividadxxx,"- (",e.dataitem.sequencia,")")}}function ht(h,_){if(1&h){const e=t.EpF();t.TgZ(0,"ion-button",35),t.NdJ("click",function(){return t.CHM(e),t.oxw().otrasop2()}),t.ALo(1,"translate"),t._uU(2),t.ALo(3,"translate"),t.qZA()}2&h&&(t.s9C("title",t.lcZ(1,2,"MENUM")),t.xp6(2),t.hij(" ",t.lcZ(3,4,"detalle_informa0")," "))}function mt(h,_){if(1&h&&(t.TgZ(0,"div"),t._UZ(1,"dynamic-form",36,37),t.qZA()),2&h){const e=t.oxw();t.xp6(1),t.Q6J("controls",e.controls)("form",e.form)}}function pt(h,_){1&h&&(t.TgZ(0,"div",38),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&h&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"obteniendo_info")," "))}function ft(h,_){if(1&h){const e=t.EpF();t.TgZ(0,"ion-button",39),t.NdJ("click",function(){return t.CHM(e),t.oxw().submitForm0()}),t._uU(1),t.ALo(2,"translate"),t.qZA()}if(2&h){const e=t.oxw();t.Q6J("hidden",!e.muestrabien),t.xp6(1),t.hij("",t.lcZ(2,2,"enviar_a")," ")}}let gt=(()=>{class h{constructor(e,a,i,o,r,s,d,c,l,n,u){this.platform=e,this.Pdfx=a,this.location=i,this.popoverCtrl=o,this.alertController=r,this.router=s,this.modalController=d,this.controlsService=c,this.translateService=l,this.authenticationService=n,this.actionSheetController=u,this.variables=[],this.userinfo=[],this.tituloxx="",this.seguro="",this.msg="",this.vgrupo=[],this.permisosorden=[],this.fechascompone=[],this.horascompone=[],this.actividades=[],this.acciones=[],this.datosusuario=[],this.submitted=[],this.submitted2=[],this.actorcorreo=[],this.cmpver=[],this.permisototal="no",this.botonesactividad=[],this.camposdetallepermisos=[],this.camposmodifica=[],this.camposlectura=[],this.keysprint=[],this.comandos=[],this.items2=[],this.tienedetalle=0,this.muestrabien=!1,this.datosreghtml="",this.apifoto=this.authenticationService.getapifoto()}dismissModal(){this.modalController.dismiss("close")}ionViewDidEnter(){}ngOnInit(){if(this.variables=this.router.getCurrentNavigation().extras.state.variables,this.modopcx="modal-fullscreen","true"===this.variables.modopc&&(this.platform.is("desktop")||this.platform.is("mobileweb"))&&(this.modopcx="modal-fullscreen2"),this.comandos=void 0===this.router.getCurrentNavigation().extras.state.variables.comandos?[]:this.router.getCurrentNavigation().extras.state.variables.comandos,this.nidformulario=this.router.getCurrentNavigation().extras.state.record2.nidformulario,this.idformulario=this.router.getCurrentNavigation().extras.state.record2.idformulario,this.OPERACIONT=this.authenticationService.datraduccion("actualizar")+" "+this.nidformulario,this.titulo1=this.authenticationService.datraduccion("actualizar")+" "+this.nidformulario,this.titulo2=this.authenticationService.datraduccion("camios_deseas")+" "+this.nidformulario,this.userinfo=this.authenticationService.getcopiauser(),this.tituloxx=this.router.getCurrentNavigation().extras.state.title,this.titleoo=this.router.getCurrentNavigation().extras.state.title,this.permisosorden=this.router.getCurrentNavigation().extras.state.record2.permisosorden,this.vistahtml=this.router.getCurrentNavigation().extras.state.record2.vistahtml,this.vistahtml2=this.router.getCurrentNavigation().extras.state.record2.vistahtml2,this.idcategoria=this.router.getCurrentNavigation().extras.state.record2.idcategoria,this.cerrarxxx=this.router.getCurrentNavigation().extras.state.record2.cerrarxxx,this.ususariopublico=this.router.getCurrentNavigation().extras.state.record.ususariopublico,this.ususariopublico2=this.router.getCurrentNavigation().extras.state.record.ususariopublico2,this.dahtml=this.router.getCurrentNavigation().extras.state.record2.dahtml,this.regitrosacumulados=this.router.getCurrentNavigation().extras.state.record2.regitrosacumulados,this.vista=this.router.getCurrentNavigation().extras.state.record2.vista,this.geoposiciontxt=this.router.getCurrentNavigation().extras.state.record2.geoposiciontxt,this.tipo2=this.router.getCurrentNavigation().extras.state.record2.tipo2,this.tipo=this.router.getCurrentNavigation().extras.state.record2.tipo,this.ejecuta=this.router.getCurrentNavigation().extras.state.record2.ejecuta,this.ejecutainicio=this.router.getCurrentNavigation().extras.state.record2.ejecutainicio,this.ejecutaactualiza=this.router.getCurrentNavigation().extras.state.record2.ejecutaactualiza,this.ejecutaelimina=this.router.getCurrentNavigation().extras.state.record2.ejecutaelimina,this.verregistros="",this.acciones=this.router.getCurrentNavigation().extras.state.record2.acciones,this.cmpver=this.router.getCurrentNavigation().extras.state.datat,this.actividades=this.router.getCurrentNavigation().extras.state.record2.actividades,this.actorcorreo=this.router.getCurrentNavigation().extras.state.record2.actorcorreo,this.dataitem=this.router.getCurrentNavigation().extras.state.record,this.authenticationService.convertToDataURLviaCanvas(this.authenticationService.getapifoto()+this.userinfo[0].idempresa.foto0,"image/png").then(a=>this.logotipoempresa=a),this.authenticationService.getReg("todos/Activo/"+this.userinfo[0].idempresa._id+"/"+this.dataitem.idactividadxxx,"frmactividadcamposds",0).then(a=>{this.camposdetallepermisos=a}),this.authenticationService.getReg(this.idformulario+"/camposdetalle/"+this.userinfo[0].idempresa._id+"/1","frmmovilds",0).then(a=>{let i=[];if(i=a,this.items2=[],i.length>0){this.tienedetalle=1;for(let o=0;o<i.length;o++){let r="";"Check List Detalle"===a[o].type&&(r="Check list "),this.items2.push(0===o?{name:a[o].name,type:"radio",label:r+a[o].title,checked:!0,value:a[o]._id+"\xb0"+a[o].idformdetalle.id+"\xb0/ProductoListPage\xb0"+a[o].title+" ->"+this.nidformulario+"\xb0"+a[o].type+"\xb0"+a[o].maxnumregistros+"\xb0"+a[o].idmovil}:{name:a[o].name,type:"radio",label:r+a[o].title,checked:!1,value:a[o]._id+"\xb0"+a[o].idformdetalle.id+"\xb0/ProductoListPage\xb0"+a[o].title+" ->"+this.nidformulario+"\xb0"+a[o].type+"\xb0"+a[o].maxnumregistros+"\xb0"+a[o].idmovil})}}},a=>{this.authenticationService.presentAlert(a.error,this.msg,"")}),this.translateService.get("SEGUROM").subscribe(a=>{this.seguro=a}),this.translateService.get("MSGM").subscribe(a=>{this.msg=a}),null==this.dataitem){if(this.actactual=this.daactividadactual("INICIO",this.actividades),this.usuariosss=this.actactual.usuarios,this.actactual.usuarios)for(var e=0;e<this.actactual.usuarios.length;e++)if(this.actactual.usuarios[e].email===this.userinfo[0]._id){this.permisototal="si";break}this.actactual&&this.daacciones(this.acciones,this.actactual._id),this.translateService.get("NUEVOM").subscribe(a=>{this.tituloxx=a+" "+this.tituloxx,this.lpermiso=a})}else{if(this.actactual=this.daactividadactual2(this.dataitem.idactividadxxx,this.actividades),this.usuariosss=this.actactual.usuarios,this.actactual.usuarios)for(e=0;e<this.actactual.usuarios.length;e++)if(this.actactual.usuarios[e].email===this.userinfo[0]._id){this.permisototal="si";break}this.actactual&&this.daacciones(this.acciones,this.actactual._id),this.translateService.get("ACTUALIZAM").subscribe(a=>{this.tituloxx=a+" "+this.tituloxx,this.lpermiso=a}),this._ID=this.dataitem._id}this.form=new j.cw({}),this.onValueChanges()}onValueChanges(){this.form.valueChanges.subscribe(e=>{this.submitted=e})}davaloritem(e,a){let i="";return i=e[a]?e[a]:"",i}str2DOMElement(e){var a=document.createElement("iframe");a.style.display="none",document.body.appendChild(a),a.contentDocument.open(),a.contentDocument.write(e),a.contentDocument.close();var i=a.contentDocument.body.firstChild;return document.body.removeChild(a),i}printexcel(e){return(0,v.mG)(this,void 0,void 0,function*(){this.authenticationService.getReg(this.nidformulario+"\xb0"+this.idformulario+"/"+e._id+"/"+this.userinfo[0].idempresa._id+"/frmmovilpreporteexcel/1","frmmovils",0).then(a=>{console.log(a),this.authenticationService.bajarexcel(a.estado,"requisicion"+e.nodocumento+".xlsx")})})}printpdf(e){return(0,v.mG)(this,void 0,void 0,function*(){let a=[];var i=new Date(e.createdAt).toISOString().substr(0,10);a.push({text:" "}),a.push("No"===this.userinfo[0].idempresa.sicorrelativo?{text:["No ticket: ",{text:e.sequencia,fontSize:15,bold:!0,alignment:"center"}],alignment:"right"}:{text:["No ticket: ",{text:e.sequenciag,fontSize:15,bold:!0,alignment:"center"}],alignment:"right"}),a.push({text:[{text:"Fecha creacion: ",bold:!0},{text:i}]}),a.push({text:[{text:"Usuario creador: ",bold:!0},{text:e.usuarionew2}]}),a.push({text:" "}),a.push({text:[{text:"Procedimiento: ",bold:!0},{text:this.nidformulario}]}),this.keysprint=Object.keys(e);let o=[];o.push([{text:"Informaci\xf3n",bold:!0,fontSize:9}]);for(let d=0;d<this.keysprint.length;d++){const c=this.keysprint[d];var r=this.actactual.camposimprime.nombre.split(",");for(let l=0;l<r.length;l++)if(String(r[l]).trim()===this.keysprint[d]){let n="";n=this.authenticationService.getKeys2(e[c]),String(n).indexOf("\xb0")>0?o.push([{text:this.authenticationService.getKeys3(this.cmpver,c,1)+" : "+this.authenticationService.getKeyssrthtml(n)+"<br>",bold:!0,fontSize:9}]):String(n).indexOf("\xac")>0?o.push([{text:this.authenticationService.getKeys3(this.cmpver,c,0)+" : "+this.authenticationService.htmltostring(n.split("\xac")[0]),bold:!0,fontSize:9}]):String(n).indexOf("/api/image")>=0?o.push([{text:this.authenticationService.getKeys3(this.cmpver,c,0)+" : "+this.authenticationService.getapifoto()+n,link:this.authenticationService.getapifoto()+n,decoration:"underline",bold:!0,fontSize:9}]):String(n).indexOf("000Z")>=0?o.push([{text:this.authenticationService.getKeys3print(this.cmpver,c,0)+" : "+n.substr(0,10),bold:!0,fontSize:9}]):o.push([{text:this.authenticationService.getKeys3print(this.cmpver,c,0)+" : "+n,bold:!0,fontSize:9}])}}const s={operacion:"pdfprocesosdefault",id:this.nidformulario+"\xb0"+this.idformulario+"\xb0"+e._id,id2:o,id3:this.userinfo[0].idempresa._id,id4:"frmmovilpreportepdf",id5:a};s&&this.authenticationService.createRegmovil("moviltodo",s,"frmmovils").then(d=>{var c;console.log(d),c=d,console.log(c.estado),this.Pdfx.printfrmsolologos(this.nidformulario,e,this.tipo2,c.estado,this.logotipoempresa,this.userinfo[0].idempresa.nombre,this.userinfo[0].nombrealias,this.authenticationService.dafechastringtodatefinal(new Date,"dd-MM-yyyy, hh:mm aaa"),this.userinfo[0].idempresa.subtitulo,this.actactual.nombre,this.userinfo[0].idempresa.simarca,"portrait")})})}printa(e){return(0,v.mG)(this,void 0,void 0,function*(){this.authenticationService.printproceso(e,this.userinfo,this.nidformulario,this.actactual,this.cmpver,this.idformulario,this.logotipoempresa,this.tipo)})}print(e){return(0,v.mG)(this,void 0,void 0,function*(){let a=[];var i=new Date(e.createdAt).toISOString().substr(0,10);a.push({text:" "}),a.push("No"===this.userinfo[0].idempresa.sicorrelativo?{text:["No ticket: ",{text:e.sequencia,fontSize:15,bold:!0,alignment:"center"}],alignment:"right"}:{text:["No ticket: ",{text:e.sequenciag,fontSize:15,bold:!0,alignment:"center"}],alignment:"right"}),a.push({text:[{text:"Fecha creacion: ",bold:!0},{text:i}]}),a.push({text:[{text:"Usuario creador: ",bold:!0},{text:e.usuarionew2}]}),a.push({text:" "}),a.push({text:[{text:"Procedimiento: ",bold:!0},{text:this.nidformulario}]}),this.keysprint=Object.keys(e);let o=[];o.push([{text:"Informaci\xf3n",bold:!0,fontSize:9}]);for(let d=0;d<this.keysprint.length;d++){const c=this.keysprint[d];var r=this.actactual.camposimprime.nombre.split(",");for(let l=0;l<r.length;l++)if(String(r[l]).trim()===this.keysprint[d]){let n="";n=this.authenticationService.getKeys2(e[c]),String(n).indexOf("\xb0")>0?o.push([{text:this.authenticationService.getKeys3(this.cmpver,c,1)+" : "+this.authenticationService.getKeyssrthtml(n)+"<br>",bold:!0,fontSize:9}]):String(n).indexOf("\xac")>0?o.push([{text:this.authenticationService.getKeys3(this.cmpver,c,0)+" : "+this.authenticationService.htmltostring(n.split("\xac")[0]),bold:!0,fontSize:9}]):String(n).indexOf("/api/image")>=0?o.push([{text:this.authenticationService.getKeys3(this.cmpver,c,0)+" : "+this.authenticationService.getapifoto()+n,link:this.authenticationService.getapifoto()+n,decoration:"underline",bold:!0,fontSize:9}]):String(n).indexOf("000Z")>=0?o.push([{text:this.authenticationService.getKeys3print(this.cmpver,c,0)+" : "+n.substr(0,10),bold:!0,fontSize:9}]):o.push([{text:this.authenticationService.getKeys3print(this.cmpver,c,0)+" : "+n,bold:!0,fontSize:9}])}}const s={operacion:"pdfprocesosdefault",id:this.idformulario+"\xb0printgeneralprocesos\xb0"+e._id,id2:o,id3:this.userinfo[0].idempresa._id,id4:"frmmovilpreportepdf",id5:a};s&&this.authenticationService.createRegmovil("moviltodo",s,"frmmovils").then(d=>{var c;console.log(d),c=d,console.log(c.estado),this.Pdfx.printfrmsolologos(this.nidformulario,e,this.tipo2,c.estado,this.logotipoempresa,this.userinfo[0].idempresa.nombre,this.userinfo[0].idempresa.email,this.authenticationService.dafechastringtodatefinal(new Date,"dd-MM-yyyy, hh:mm aaa"),this.userinfo[0].idempresa.subtitulo,this.actactual.nombre,this.userinfo[0].idempresa.simarca,"portrait")})})}trayectoria(e){return(0,v.mG)(this,void 0,void 0,function*(){this.router.navigate(["frmordencomponenteListPage"],{state:{variables:null,keyxxx:1,idllave:this.dataitem._id,title:"Trayectoria orden ->"+this.titleoo}})})}deleteRecord(){return(0,v.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({header:this.seguro,message:"",buttons:[{text:this.authenticationService.datraduccion("cancelar"),cssClass:"secondary",handler:a=>{}},{text:this.authenticationService.datraduccion("aceptar"),handler:()=>{this.authenticationService.deleteReg(this.dataitem._id+"/"+this.idformulario+"/proceso/"+this.userinfo[0].email+"/"+this.userinfo[0].idempresa._id+"/na","frmmovils").then(i=>{this.router.navigate(["formulariomovilsdprocesoListPage"]),this.authenticationService.retornaordenes()},i=>{this.authenticationService.presentAlert(i.error,this.msg,"")})}}]})).present()})}comandoscmd(){return(0,v.mG)(this,void 0,void 0,function*(){for(var e=[],a=0;a<this.comandos.length;a++)e.push(0===a?{name:this.comandos[a].nombre,type:"radio",label:this.comandos[a].nombre,checked:!0,value:this.comandos[a].email+"\xb0"+this.comandos[a].nombre}:{name:this.comandos[a].nombre,type:"radio",label:this.comandos[a].nombre,checked:!1,value:this.comandos[a].email+"\xb0"+this.comandos[a].nombre});yield(yield this.alertController.create({cssClass:"my-custom-class",header:this.authenticationService.datraduccion("sel_opcion"),inputs:e,buttons:[{text:this.authenticationService.datraduccion("cancelar"),role:"cancel",cssClass:"secondary",handler:o=>{}},{text:this.authenticationService.datraduccion("aceptar"),handler:o=>{for(var r=this.sirequeridospp.split("\xb0"),s=0;s<r.length;s++)""===this.submitted[r[s]]&&(this.submitted[r[s]]="0");this.enviacomando(this.idformulario,o)}}]})).present()})}enviacomando(e,a){return(0,v.mG)(this,void 0,void 0,function*(){let i="Actualiza";for(let n=0;n<this.fechascompone.length;n++)this.submitted[this.fechascompone[n]]=this.authenticationService.dafecha(this.submitted[this.fechascompone[n]],2);if(null==this.dataitem&&(i="Crea"),null!==this.dataitem){for(var o=this.dataitem.pmodulo,r=[],s=0;s<o.length;s++)r.push(o[s][0]);o.push(this.userinfo[0]._id);var d=this.objectToArray(this.submitted),c=this.objectToArray(this.dataitem),l="";for(let u=0;u<d.length;u++)for(let p=0;p<c.length;p++)d[u][0]===c[p][0]&&d[u][1]===c[p][1]&&(l=l+d[u][0]+"\xb0");const n={operacion:"actualizasimple",idcat:this.idcategoria,idform:this.dataitem._id,formulario:this.idformulario,nformulario:this.nidformulario,estructura:this.submitted,norequeridospp:this.norequeridospp,tipo:this.tipo,tipo2:this.tipo2,nocambio:l,bitacora:{idempresa:this.userinfo[0].idempresa._id,idafiliado:"",email:this.userinfo[0].email,permiso:i,accion:"Actualiza en formulario movil"}};n&&this.authenticationService.createRegmovil(this.dataitem._id,n,"frmmovils").then(u=>{this.authenticationService.getReg(this.idformulario+"\xb0"+e+"\xb0"+a+"/dasegunformulario/gesorden","frmmovils",0).then(p=>{var f,y,m=e+"\xb0"+a;y=p,f=this.devuelvenorden(p);var A=this.daactividadsiguienteaccion(y.actividad);if(void 0===m||""===m)this.authenticationService.presentAlert("Formulario no tiene ninguna operaci\xf3n de ejecuci\xf3n definida","Precauci\xf3n","");else{var q=[];q.push({tabla:this.nidformulario,idtabla:this.idformulario,item:this.dataitem});const g={operacion:"ejecutaoperacion",idempresa:this.userinfo[0].idempresa._id,idcat:this.idcategoria,idform:this.idformulario,nidform:this.nidformulario,estructura:"nada",geoposiciontxt:this.geoposiciontxt,acumulados:q,fecha:this.dataitem.createdAt,itemsx:this.dataitem,idpapa:this.idllave,actividadsigaccion:{id:A.id,nombre:A.nombre},optionorden:f.__zone_symbol__value,tipo:this.tipo,usuarioejecutor:{id:this.userinfo[0]._id,nombre:this.userinfo[0].nombre,email:this.userinfo[0].email,usuarionew2:this.userinfo[0].nombrealias},tipo2:this.tipo2,ejecuta:m,bitacora:{idempresa:this.userinfo[0].idempresa._id,idafiliado:"",email:this.userinfo[0].email,permiso:"Crear",accion:""}};g&&this.authenticationService.createRegmovil("",g,"frmmovils").then(b=>{var C;"csv"===(C=b).tipo?(this.authenticationService.bajarexcel(C.data,"nombre comando.csv"),this.router.navigate(["formulariomovilsdprocesoListPage"]),this.authenticationService.retornaordenes()):(this.authenticationService.presentAlert(C.data.estado,"","Exito"),this.router.navigate(["formulariomovilsdprocesoListPage"]),this.authenticationService.retornaordenes())},b=>{this.router.navigate(["formulariomovilsdprocesoListPage"]),this.authenticationService.retornaordenes(),this.authenticationService.presentAlert(b.error,"Precauci\xf3n","")})}})},u=>{this.router.navigate(["formulariomovilsdprocesoListPage"]),this.authenticationService.retornaordenes(),this.authenticationService.presentAlert(u.error,"Precauci\xf3n","")})}})}otrasop(){return(0,v.mG)(this,void 0,void 0,function*(){var e=[];"true"===this.permisosorden.eliminaorden&&"activo"===this.dataitem.estadointerno&&e.push({name:"Eliminar orden",type:"radio",label:"Eliminar orden",checked:!0,value:"1"}),"true"===this.permisosorden.finalizaorden&&"activo"===this.dataitem.estadointerno&&e.push({name:"Finalizar orden",type:"radio",label:"Finalizar orden",checked:!1,value:"2"}),"true"===this.permisosorden.pausarorden&&"activo"===this.dataitem.estadointerno&&e.push({name:"Pausar orden",type:"radio",label:"Pausar orden",checked:!1,value:"3"}),"true"===this.permisosorden.anularorden&&"activo"===this.dataitem.estadointerno&&e.push({name:"Anular orden",type:"radio",label:"Anular orden",checked:!1,value:"4"}),"true"===this.permisosorden.cancelarorden&&"activo"===this.dataitem.estadointerno&&e.push({name:"Cancelar orden",type:"radio",label:"Cancelar orden",checked:!1,value:"5"}),"true"===this.permisosorden.reasignarorden&&e.push({name:"Reasignar orden",type:"radio",label:"Reasignar orden",checked:!1,value:"6"}),"true"===this.permisosorden.bitacoraorden&&e.push({name:"Bitacora comentarios orden",type:"radio",label:"Bitacora comentarios orden",checked:!1,value:"7"}),"true"===this.permisosorden.papaorden&&e.push({name:"Ver ordenes hijas",type:"radio",label:"Ver ordenes hijas",checked:!1,value:"8"}),yield(yield this.alertController.create({cssClass:"my-custom-class",header:this.authenticationService.datraduccion("sel_opcion"),inputs:e,buttons:[{text:this.authenticationService.datraduccion("cancelar"),role:"cancel",cssClass:"secondary",handler:i=>{}},{text:this.authenticationService.datraduccion("aceptar"),handler:i=>{switch(i){case"1":this.deleteRecord();break;case"2":this.ordenRecord0("Finalizar orden");break;case"3":this.ordenRecord0("Pausar orden");break;case"4":this.ordenRecord0("Anular orden");break;case"5":this.ordenRecord0("Cancelar orden");break;case"6":this.combodatos("1","actividadsiguiente-plantilla","frmcats","actividadsiguiente","actividadsiguiente","actividadsiguiente");break;case"7":this.pdfbitacoracomentarios();break;case"8":this.pdfhijas()}}}]})).present()})}pdfdocumentacionorden(){return(0,v.mG)(this,void 0,void 0,function*(){let e=[],a=[];a.push({margin:[0,0,0,10],layout:{fillColor:function(l,n,u){return l%2==0?"#ebebeb":"#f5f5f5"}},table:{widths:["100%"],heights:[20,10],body:[[{text:"Documentaci\xf3n de proceso "+this.nidformulario,fontSize:14,alignment:"center",margin:[0,10],bold:!0}]]}}),a.push({columns:[{qr:this.authenticationService.daservert()+"/?key=resultadoclibres&key2=",fit:75,alignment:"rigth"},{stack:["Usuario creador: "+this.dataitem.usuarionew,"No. ticket: "+this.dataitem.sequencia,"Estado: "+this.dataitem.estadoxxx],width:"*",margin:[0,15]}],margin:[15,15]}),a.push({text:""}),e.push([{text:"Actividades del proceso",colSpan:5,bold:!0,alignment:"center",fontSize:12},{},{},{},{}]),e.push([{text:"Orden",bold:!0,fontSize:11},{text:"Nombre de la actividad",bold:!0,fontSize:11},{text:"Actor",bold:!0,fontSize:11},{text:"Clase",bold:!0,fontSize:11},{text:"Estado",bold:!0,fontSize:11}]);for(let l=0;l<this.actividades.length;l++)e.push([{text:this.actividades[l].orden,fontSize:10},{text:this.actividades[l].nombre,fontSize:10},{text:this.actividades[l].actor.nombre,fontSize:10},{text:this.actividades[l].clase,fontSize:10},{text:this.actividades[l].estado,fontSize:10}]);a.push({text:""}),a.push({style:"tableExample",margin:[0,0,0,10],layout:{fillColor:function(l,n,u){return 0===l||1===l?"#ACE7FF":null}},table:{widths:[50,"*",100,"*"],heights:[20,10],headerRows:1,body:this.camposproceso}}),a.push({text:""}),a.push({text:""}),a.push({text:""}),a.push({style:"tableExample",margin:[0,0,0,10],layout:{fillColor:function(l,n,u){return 0===l||1===l?"#D5D6EA":null}},table:{widths:[50,"*",100,50,50],heights:[20,10],headerRows:1,body:e}});var i=[];i.push([{text:"Actores del proceso",colSpan:3,bold:!0,alignment:"center",fontSize:12},{},{}]),i.push([{text:"Actor",bold:!0,fontSize:11},{text:"Estado",bold:!0,fontSize:11},{text:"Usuarios",bold:!0,fontSize:11}]);for(let l=0;l<this.actorcorreo.length;l++)i.push([{text:this.actorcorreo[l].nombre,fontSize:10},{text:this.actorcorreo[l].estado,fontSize:10},{text:this.replaceAll(this.actorcorreo[l].nombreusuarios,"\xb0"," - "),fontSize:10}]);a.push({style:"tableExample",margin:[0,0,0,10],layout:{fillColor:function(l,n,u){return 0===l||1===l?"#F3DDF2":null}},table:{widths:[100,50,"*"],heights:[20,10],headerRows:1,body:i}});var o=[];o.push([{text:"Acciones del proceso",colSpan:3,bold:!0,alignment:"center",fontSize:12},{},{}]),o.push([{text:"Actividad",bold:!0,fontSize:11},{text:"Estado",bold:!0,fontSize:11},{text:"Acciones",bold:!0,fontSize:11}]);var r="";for(let l=0;l<this.actividades.length;l++){r=this.actividades[l].nombre;var d=[];for(let n=0;n<this.acciones.length;n++)String(this.actividades[l]._id)===this.acciones[n].idpapa&&d.push(this.acciones[n].tipo+": "+this.acciones[n].nombre+"  ("+this.acciones[n].estado+")");o.push([{text:r,fontSize:10},{text:this.actividades[l].estado,fontSize:10},{stack:[{ul:d}]}])}a.push({style:"tableExample",margin:[0,0,0,10],layout:{fillColor:function(l,n,u){return 0===l||1===l?"#D5DD6A":null}},table:{widths:[100,50,"*"],heights:[20,10],headerRows:1,body:o}});var c=[];c.push([{text:"Comandos del proceso",colSpan:2,bold:!0,alignment:"center",fontSize:12},{}]),c.push([{text:"Nombre",bold:!0,fontSize:11},{text:"Comando",bold:!0,fontSize:11}]);for(let l=0;l<this.comandos.length;l++)c.push([{text:this.comandos[l].nombre,fontSize:10},{text:this.comandos[l].correo,fontSize:10}]);a.push({style:"tableExample",margin:[0,0,0,10],layout:{fillColor:function(l,n,u){return 0===l||1===l?"# D7ECD9":null}},table:{widths:["*","*"],heights:[20,10],headerRows:1,body:c}}),this.Pdfx.printdocproceso("Documentaci\xf3n de proceso "+this.nidformulario,a,this.logotipoempresa,this.userinfo[0].idempresa.nombre,this.userinfo[0].email,this.authenticationService.dafechastringtodatefinal(new Date,"dd-MM-yyyy, hh:mm aaa"),this.userinfo[0].idempresa.subtitulo,"",this.userinfo[0].idempresa.simarca)})}pdfbitacoracomentarios(){return(0,v.mG)(this,void 0,void 0,function*(){this.authenticationService.getReg(this.dataitem._id+"/trayectoriaordencomentario/"+this.userinfo[0].idempresa._id,"frmmovils",0).then(e=>{var a;a=e;let i=[],o=[];o.push({margin:[0,0,0,10],layout:{fillColor:function(s,d,c){return s%2==0?"#ebebeb":"#f5f5f5"}},table:{widths:["100%"],heights:[20,10],body:[[{text:"Bitacora de comentarios, proceso: "+this.nidformulario,fontSize:14,alignment:"center",margin:[0,10],bold:!0}]]}});var r;r="No"===this.userinfo[0].idempresa.sicorrelativo?this.dataitem.sequencia:this.dataitem.sequenciag,o.push({columns:[{qr:this.authenticationService.daservert()+"/?key=resultadoclibres&key2=",fit:75,alignment:"rigth"},{stack:["Usuario creador: "+this.dataitem.usuarionew,"No. ticket: "+r,"Estado: "+this.dataitem.estadoxxx],width:"*",margin:[0,15]}],margin:[15,15]}),o.push({text:""}),i.push([{text:"Bitacora de comentarios",colSpan:5,bold:!0,alignment:"center",fontSize:12},{},{},{},{}]),i.push([{text:"Fecha ingreso",bold:!0,fontSize:11},{text:"Fecha salida",bold:!0,fontSize:11},{text:"Actividad",bold:!0,fontSize:11},{text:"Usuario",bold:!0,fontSize:11},{text:"Comentario",bold:!0,fontSize:11}]);for(let s=0;s<a.length;s++)i.push([{text:this.authenticationService.dafechastringtodatefinal(a[s].fechaingreso,"dd-MM-yyyy, hh:mm aaa"),fontSize:10},{text:this.authenticationService.dafechastringtodatefinal(a[s].fechasalida,"dd-MM-yyyy, hh:mm aaa"),fontSize:10},{text:a[s].actividad,fontSize:10},{text:a[s].usuario,fontSize:10},{text:a[s].comentario,fontSize:10}]);o.push({text:""}),o.push({style:"tableExample",margin:[0,0,0,10],layout:{fillColor:function(s,d,c){return 0===s||1===s?"#D5D6EA":null}},table:{widths:[75,75,"*",50,"*"],heights:[20,10],headerRows:1,body:i}}),this.Pdfx.printdocproceso("Bitacora de comentarios proceso: "+this.nidformulario,o,this.logotipoempresa,this.userinfo[0].idempresa.nombre,this.userinfo[0].idempresa.email,this.authenticationService.dafechastringtodatefinal(new Date,"dd-MM-yyyy, hh:mm aaa"),this.userinfo[0].idempresa.subtitulo,this.actactual.nombre,this.userinfo[0].idempresa.simarca)},e=>{this.authenticationService.presentAlert(e.error,this.msg,"")})})}pdfhijas(){return(0,v.mG)(this,void 0,void 0,function*(){this.authenticationService.getReg(this.dataitem._id+"/"+this.idformulario+"/"+this.userinfo[0].idempresa._id+"/ordenhijas","frmmovils",0).then(e=>{var a;a=e;let i=[],o=[];o.push({margin:[0,0,0,10],layout:{fillColor:function(r,s,d){return r%2==0?"#ebebeb":"#f5f5f5"}},table:{widths:["100%"],heights:[20,10],body:[[{text:"Ordenes hijas, proceso: "+this.nidformulario,fontSize:14,alignment:"center",margin:[0,10],bold:!0}]]}}),o.push({columns:[{qr:this.authenticationService.daservert()+"/?key=resultadoclibres&key2=",fit:75,alignment:"rigth"},{stack:["Usuario creador: "+this.dataitem.usuarionew,"Actividad: "+this.dataitem.actividadxxx,"Actor: "+this.dataitem.actorxxx,"No. ticket: "+this.dataitem.sequencia,"Estado: "+this.dataitem.estadoxxx],width:"*",margin:[0,15]}],margin:[15,15]}),o.push({text:""}),o.push({text:""}),i.push([{text:"Ordenes hijas",colSpan:5,bold:!0,alignment:"center",fontSize:12},{},{},{},{},{}]),i.push([{text:"No ticket",bold:!0,fontSize:11},{text:"Tipo",bold:!0,fontSize:11},{text:"Actividad",bold:!0,fontSize:11},{text:"Estado",bold:!0,fontSize:11},{text:"Actor",bold:!0,fontSize:11},{text:"Usuario",bold:!0,fontSize:11}]);for(let r=0;r<a.length;r++)i.push([{text:a[r].sequencia,fontSize:10},{text:a[r].actividadxxx,fontSize:10},{text:a[r].actividadxxx,fontSize:10},{text:a[r].estadoxxx,fontSize:10},{text:a[r].actorxxx,fontSize:10},{text:a[r].usuarionew,fontSize:10}]);o.push({text:""}),o.push({style:"tableExample",margin:[0,0,0,10],layout:{fillColor:function(r,s,d){return 0===r||1===r?"#D5D6EA":null}},table:{widths:[75,"*","*",50,50,50],heights:[20,10],headerRows:1,body:i}}),this.Pdfx.printdocproceso("Ordenes hijas proceso: "+this.nidformulario,o,this.logotipoempresa,this.userinfo[0].idempresa.nombre,this.userinfo[0].idempresa.email,this.authenticationService.dafechastringtodatefinal(new Date,"dd-MM-yyyy, hh:mm aaa"),this.userinfo[0].idempresa.subtitulo,this.actactual.nombre,this.userinfo[0].idempresa.simarca)},e=>{this.authenticationService.presentAlert(e.error,this.msg,"")})})}ordenRecord0(e){return(0,v.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({cssClass:"my-custom-class",header:this.authenticationService.datraduccion("ingrese_comentario"),inputs:[{name:"comentario",id:"comentario",type:"textarea",placeholder:this.authenticationService.datraduccion("ingrese_motivo")}],buttons:[{text:this.authenticationService.datraduccion("cancelar"),role:"cancel",cssClass:"secondary",handler:()=>{}},{text:this.authenticationService.datraduccion("aceptar"),handler:i=>{this.ordenRecord(e,i.comentario)}}]})).present().then(()=>{document.querySelector("ion-alert textarea").focus()})})}ordenRecord(e,a){return(0,v.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({header:this.seguro,message:"",buttons:[{text:this.authenticationService.datraduccion("cancelar"),cssClass:"secondary",handler:o=>{}},{text:this.authenticationService.datraduccion("aceptar"),handler:()=>{if("Finalizar orden"===e)this.actactual=this.daactividadactual("FINAL",this.actividades),void 0===this.actactual?this.authenticationService.presentAlert("No existe actividad FINAL definida en el proceso","Precauci\xf3n",""):this.moverorden(this.actactual._id,e,a);else{var o=this.daactividadsiguienteaccion(this.dataitem.idactividadxxx);const r={operacion:"actualizaprocesodirecto",idform:this.dataitem._id,nidform:this.nidformulario,fecha:this.dataitem.createdAt,sequenciag:this.dataitem.sequenciag,sequencia:this.dataitem.sequencia,formulario:this.idformulario,actividadsigaccion:{id:o.id,nombre:o.nombre},usuarioejecutor:{id:this.userinfo[0]._id,nombre:this.userinfo[0].nombre,email:this.userinfo[0].email,usuarionew2:this.userinfo[0].nombrealias},update:{estadointerno:e,comentarioorden:a,estadoordenxxx:e},estado:e,bitacora:{idempresa:this.userinfo[0].idempresa._id,idafiliado:"",email:this.userinfo[0].email,permiso:"Actualiza",accion:"actualiza proceso opcion "+e+" "+this.idllave+"  "+this.dataitem._id}};r&&this.authenticationService.createRegmovil("",r,"frmmovils").then(s=>{this.router.navigate(["formulariomovilsdprocesoListPage"],{state:{user:"1"}}),this.authenticationService.retornaordenes()},s=>{this.authenticationService.presentAlert(s.error,"Precauci\xf3n","")})}}}]})).present()})}retorna(){this.router.navigate(["formulariomovilsdprocesoListPage"])}replaceAll(e,a,i){return e.replace(new RegExp(a,"g"),i)}presentPopover(e){return(0,v.mG)(this,void 0,void 0,function*(){var a="false";("true"===this.permisosorden.eliminaorden||"true"===this.permisosorden.finalizaorden||"true"===this.permisosorden.pausarorden||"true"===this.permisosorden.anularorden||"true"===this.permisosorden.cancelarorden||"true"===this.permisosorden.reasignarorden||"true"===this.permisosorden.bitacoraorden||"true"===this.permisosorden.papaorden)&&(a="true");const i=yield this.popoverCtrl.create({component:V,event:e,componentProps:{permisosorden:this.permisosorden,vista:this.vista,otras:a,estadointerno:this.dataitem.estadointerno}});i.onWillDismiss().then(o=>{var r=this.dataitem.estadointerno;"Estados del proceso"===o.data.data&&this.router.navigate(["frmordencomponenteListPage"],{state:{variables:null,keyxxx:2,estadointerno:this.dataitem.estadointerno,idllave:this.dataitem._id,idfomulario:this.idformulario,title:"Roadmap  orden ->"+this.titleoo}}),"Otras opciones"===o.data.data&&this.otrasop(),"Documentaci\xf3n de orden"===o.data.data&&this.pdfdocumentacionorden(),"Agregar Comentarios"===o.data.data&&("sololectura"===this.dataitem.estadointerno&&(this.variables.pcreacion="true",this.variables.pconsulta="true",this.variables.pcreacion="true",this.variables.peliminacion="true",this.variables.pfiltro="true",this.variables.pingreso="true",r="activo"),this.router.navigate(["formulariocomentariosListPage"],{state:{variables:this.variables,record:this.dataitem,idllave:this.dataitem._id,estadointerno0:r,record2:{act:this.dataitem.actividadxxx,acciones:this.acciones,actividades:this.actividades,tipo:this.tipo,tipo2:this.tipo2,ejecuta:this.ejecuta,geoposicion:this.geoposicion,regitrosacumulados:this.regitrosacumulados,idcategoria:this.idcategoria,idformulario:this.idformulario,nidformulario:this.nidformulario},userinfo:this.userinfo,title:o.data.data+"->"+this.titleoo}})),"Agregar Archivos"===o.data.data&&("sololectura"===this.dataitem.estadointerno&&(this.variables.pcreacion="true",this.variables.pconsulta="true",this.variables.pcreacion="true",this.variables.peliminacion="true",this.variables.pfiltro="true",this.variables.pingreso="true",r="activo"),this.router.navigate(["formulariofotosListPage"],{state:{variables:this.variables,record:this.dataitem,idllave:this.dataitem._id,estadointerno0:r,record2:{act:this.dataitem.actividadxxx,acciones:this.acciones,actividades:this.actividades,tipo:this.tipo,tipo2:this.tipo2,ejecuta:this.ejecuta,geoposicion:this.geoposicion,regitrosacumulados:this.regitrosacumulados,idcategoria:this.idcategoria,idformulario:this.idformulario,nidformulario:this.nidformulario},userinfo:this.userinfo,title:o.data.data+"->"+this.titleoo}})),"Agregar Documentos"===o.data.data&&("sololectura"===this.dataitem.estadointerno&&(this.variables.pcreacion="true",this.variables.pconsulta="true",this.variables.pcreacion="true",this.variables.peliminacion="true",this.variables.pfiltro="true",this.variables.pingreso="true",r="activo"),this.router.navigate(["formulariofotos2ListPage"],{state:{variables:this.variables,record:this.dataitem,idllave:this.dataitem._id,estadointerno0:r,record2:{act:this.dataitem.actividadxxx,acciones:this.acciones,actividades:this.actividades,tipo:this.tipo,tipo2:this.tipo2,ejecuta:this.ejecuta,geoposicion:this.geoposicion,regitrosacumulados:this.regitrosacumulados,idcategoria:this.idcategoria,idformulario:this.idformulario,nidformulario:this.nidformulario},userinfo:this.userinfo,title:o.data.data+"->"+this.titleoo}})),"Asignar Tareas segun proceso"===o.data.data&&this.router.navigate(["formulariotareasListPage"],{state:{variables:this.variables,record:this.dataitem,idllave:this.dataitem._id,estadointerno0:this.dataitem.estadointerno,record2:{act:this.dataitem.actividadxxx,acciones:this.acciones,actividades:this.actividades,tipo:this.tipo,tipo2:this.tipo2,ejecuta:this.ejecuta,geoposicion:this.geoposicion,regitrosacumulados:this.regitrosacumulados,idcategoria:this.idcategoria,idformulario:this.idformulario,nidformulario:this.nidformulario},userinfo:this.userinfo,title:o.data.data+"->"+this.titleoo}})}),yield i.present()})}daacciones(e,a){let i=0;for(let r=0;r<e.length;r++)if(e[r].idpapa===a){var o=e[r].nombre;"es"!==this.authenticationService.getlenguaje()&&(o=e[r].nombre2),0===i?(this.botonesactividad.push({name:e[r].nombre,type:"radio",label:o,checked:!0,value:e[r]}),i+=1):this.botonesactividad.push({name:e[r].nombre,type:"radio",label:o,checked:!1,value:e[r]})}}dalistacat(e,a){let i;for(let o=0;o<e.length;o++)if(e[o].label===a){i={key:e[o].key,label:e[o].label};break}return i}daactividadactual2(e,a){let i;for(let o=0;o<a.length;o++)if(a[o]._id===e){i=a[o];break}return i}daactividadactual(e,a){let i;for(let o=0;o<a.length;o++)if(a[o].clase===e){i=a[o];break}return i}daactividadsiguienteaccion(e){var a;this.actactualtemp=this.daactividadactual2(e,this.actividades);for(let i=0;i<this.acciones.length;i++)if(this.acciones[i].estado===this.actactualtemp.nombre){a=this.acciones[i];break}return{id:a.actividadsiguiente.id,nombre:a.actividadsiguiente.nombre}}daactividadsiguiente(e,a){let i;for(let o=0;o<a.length;o++)if(a[o]._id===e){i=a[o];break}return i}dagruposasignados(e,a){let i=[];for(let o=0;o<a.length;o++)a[o].idpapa===e&&i.push(a[o]._id);return i}existecampo(e,a){let i=!1;for(let o=0;o<e.length;o++)if(e[o]===a){i=!0;break}return i}ngAfterViewInit(){this.camposproceso=[],this.camposproceso.push([{text:"Campos del proceso",colSpan:4,bold:!0,alignment:"center",fontSize:12},{},{},{}]),this.camposproceso.push([{text:"Orden",bold:!0,fontSize:11},{text:"Nombre del campo",bold:!0,fontSize:11},{text:"Tipo de campo",bold:!0,fontSize:11},{text:"Nombre de etiqueta",bold:!0,fontSize:11}]),null==this.dataitem?((""!==this.actactual.camposmodificables||void 0!==this.actactual.camposmodificables)&&this.actactual.camposmodificables.id&&(this.camposmodifica=this.actactual.camposmodificables.id.split(";")),(""!==this.actactual.camposlectura||void 0!==this.actactual.camposlectura)&&this.actactual.camposlectura.id&&(this.camposlectura=this.actactual.camposlectura.id.split(";")),this.norequeridospp="",this.sirequeridospp="",this.authenticationService.getReg(this.idformulario+"/formulariod/"+this.userinfo[0].idempresa._id,"frmmovils",0).then(e=>{const a=[],i=e;for(let s=0;s<i.length;s++){const d=i[s].required;let c="",l="",n=[];switch(i[s].type){case"fecha":this.fechascompone.push(i[s].name);break;case"fechahora":this.horascompone.push(i[s].name);break;case"label":l=".";break;case"check":l=i[s].default,""===l?l="false":l||(l="false");break;case"select":n=this.dalistacat(i[s].options,i[s].default);break;default:l=i[s].default}n||(n=""),l||(l=""),c="true"===d?" (*)":" "+this.authenticationService.datraduccion("opcional");let u=!1,p=!1,m=!1,f=!1,y=!1;p=this.existecampo(this.camposmodifica,i[s]._id),!0!==p?(u=this.existecampo(this.camposlectura,i[s]._id),!0===u?(f=!1,y=i[s].required,m=!0,p=!1):(m=!1,f=!0,y=!1,this.norequeridospp=this.norequeridospp+i[s].name+"\xb0",p=!1,i[s].required&&(void 0===l||""===l||null===l)&&(l="0"))):(f=!1,u=!1,"false"===i[s].required?y=i[s].required:(y=!0,this.sirequeridospp=this.sirequeridospp+i[s].name+"\xb0")),"ejecutadas"===this.vista&&(u=!0),"si"===this.permisototal&&(p=!0);var o=i[s].title+c;"es"!==this.authenticationService.getlenguaje()&&i[s].title2&&(o=i[s].title2+c),"verquery"===i[s].type||"selectremoto"===i[s].type||"select"===i[s].type||"select2"===i[s].type?(a.push({modopxc:this.modopcx,siimagenlocal:this.userinfo[0].idempresa.siimagenes,titulo1:this.titulo1,titulo2:this.titulo2,secuenciag:this.dataitem.sequenciag,secuencia:this.dataitem.sequencia,idticket:this.dataitem._id,idformulario:this.idformulario,idcampo:i[s]._id,actualiza:"no",verregistros:i[s].verregistros,order:i[s].order,name:i[s].name,type:i[s].type,required:""+y,placeholder:i[s].placeholder,display:i[s].display,selected:i[s].selected,disabled:""+u,hidden:""+f,title:o,position:i[s].position,labelsizefondt:i[s].labelsizefondt,default:i[s].default,valor:"verquery"===i[s].type?l:n,default2:i[s].default2,default3:i[s].default3,copiarencampo:i[s].copiarencampo,categoria:i[s].categoria,combofijo:i[s].combofijo,idcadmovil:this.tt,options:i[s].options,fondoetiqueta:i[s].fondoetiqueta,coloretiqueta:i[s].coloretiqueta,blike:i[s].blike,rangomin:i[s].rangomin,rangomax:i[s].rangomax,rangostep:i[s].rangostep,alfatypo2:i[s].alfatypo2,alfatypo:i[s].alfatypo,idfrmconsulta:i[s].idfrmconsulta,idfrmconsulta2:i[s].idfrmconsulta2,idfrmconsulta2origen:i[s].idfrmconsulta2origen,idfrmconsultaorigen:i[s].idfrmconsultaorigen,usarunaves:i[s].usarunaves,idcampofiltro:i[s].idcampofiltro,idcampofiltro2:i[s].idcampofiltro2,idcampofiltromanual:i[s].idcampofiltromanual,regitrosacumulados:this.regitrosacumulados,frmapirest:i[s].frmapirest,idfrmconsultaorigenpapa:i[s].idfrmconsultaorigenpapa,idfrmconsultaorigenpapa2:i[s].idfrmconsultaorigenpapa2,idcampofiltropapa:i[s].idcampofiltropapa}),this.datosreghtml=this.datosreghtml+"<strong>"+i[s].title+"</strong>: "+l+"<br>"):(a.push({modopxc:this.modopcx,siimagenlocal:this.userinfo[0].idempresa.siimagenes,titulo1:this.titulo1,titulo2:this.titulo2,secuenciag:this.dataitem.sequenciag,secuencia:this.dataitem.sequencia,idticket:this.dataitem._id,idformulario:this.idformulario,idcampo:i[s]._id,actualiza:"no",order:i[s].order,name:i[s].name,type:i[s].type,required:""+y,placeholder:i[s].placeholder,display:""+i[s].display,selected:i[s].selected,disabled:""+u,hidden:""+f,title:o,position:i[s].position,labelsizefondt:i[s].labelsizefondt,default:i[s].default,valor:l,default2:i[s].default2,default3:i[s].default3,copiarencampo:i[s].copiarencampo,categoria:i[s].categoria,combofijo:i[s].combofijo,idcadmovil:this.tt,options:i[s].options,fondoetiqueta:i[s].fondoetiqueta,coloretiqueta:i[s].coloretiqueta,blike:i[s].blike,rangomin:i[s].rangomin,rangomax:i[s].rangomax,rangostep:i[s].rangostep,alfatypo2:i[s].alfatypo2,alfatypo:i[s].alfatypo,idfrmconsulta:"",idfrmconsulta2:"",idfrmconsulta2origen:"",idfrmconsultaorigen:"",usarunaves:"",idcampofiltro:"",idcampofiltro2:"",idcampofiltromanual:"",regitrosacumulados:"",frmapirest:"",idfrmconsultaorigenpapa:"",idcampofiltropapa:""}),this.datosreghtml=this.datosreghtml+"<strong>"+i[s].title+"</strong>: "+l+"<br>")}this.controls=this.controlsService.getControls(a),this.muestrabien="ejecutadas"!==this.vista},e=>{this.authenticationService.presentAlert(e.error,"Precauci\xf3n","")})):((""!==this.actactual.camposmodificables||void 0!==this.actactual.camposmodificables)&&this.actactual.camposmodificables.id&&(this.camposmodifica=this.actactual.camposmodificables.id.split(";")),(""!==this.actactual.camposlectura||void 0!==this.actactual.camposlectura)&&this.actactual.camposlectura.id&&(this.camposlectura=this.actactual.camposlectura.id.split(";")),this.norequeridospp="",this.sirequeridospp="",this.authenticationService.getReg(this.idformulario+"/formulariod/"+this.userinfo[0].idempresa._id,"frmmovils",0).then(e=>{const a=[],i=e;for(let r=0;r<i.length;r++){let d="";d="true"===i[r].required?" (*)":" "+this.authenticationService.datraduccion("opcional");let c="";"fecha"===(c=this.davaloritem(this.dataitem,i[r].name),i[r].type)&&(c=this.authenticationService.dafecha(c,1),this.fechascompone.push(i[r].name)),c||(c=""),"label"===i[r].type&&(c=".");let l=!1,n=!1,u=!1,p=!1,m=!1;n=this.existecampo(this.camposmodifica,i[r]._id),!0!==n?(l=this.existecampo(this.camposlectura,i[r]._id),!0===l?(p=!1,m=i[r].required,u=!0,n=!1):(u=!1,p=!0,this.norequeridospp=this.norequeridospp+i[r].name+"\xb0",m=!1,i[r].required&&(void 0===c||""===c||null===c)&&(c="0"),n=!1)):(p=!1,l=!1,"false"===i[r].required?m=!1:(m=!0,this.sirequeridospp=this.sirequeridospp+i[r].name+"\xb0"),"0"===c&&(c="")),this.camposproceso.push([{text:i[r].order,fontSize:10},{text:i[r].name,fontSize:10},{text:i[r].type,fontSize:10},{text:i[r].title+d,fontSize:10}]),"ejecutadas"===this.vista&&(l=!0),"si"===this.permisototal&&(n=!0);var o=i[r].title+d;"es"!==this.authenticationService.getlenguaje()&&i[r].title2&&(o=i[r].title2+d),"verquery"===i[r].type||"selectremoto"===i[r].type||"select"===i[r].type||"select2"==i[r].type?(a.push({modopxc:this.modopcx,siimagenlocal:this.userinfo[0].idempresa.siimagenes,titulo1:this.titulo1,titulo2:this.titulo2,papaorigen:this.dataitem.papaorigen,secuenciag:this.dataitem.sequenciag,secuencia:this.dataitem.sequencia,idticket:this.dataitem._id,idformulario:this.idformulario,idcampo:i[r]._id,actualiza:"si",verregistros:i[r].verregistros,order:i[r].order,name:i[r].name,type:i[r].type,required:""+m,placeholder:i[r].placeholder,display:i[r].display,selected:i[r].selected,disabled:""+l,hidden:""+p,title:o,position:i[r].position,labelsizefondt:i[r].labelsizefondt,default:i[r].default,valor:c,default2:i[r].default2,default3:i[r].default3,copiarencampo:i[r].copiarencampo,categoria:i[r].categoria,combofijo:i[r].combofijo,idcadmovil:this.tt,options:i[r].options,fondoetiqueta:i[r].fondoetiqueta,coloretiqueta:i[r].coloretiqueta,blike:i[r].blike,rangomin:i[r].rangomin,rangomax:i[r].rangomax,rangostep:i[r].rangostep,alfatypo2:i[r].alfatypo2,alfatypo:i[r].alfatypo,idfrmconsulta:i[r].idfrmconsulta,idfrmconsulta2:i[r].idfrmconsulta2,idfrmconsulta2origen:i[r].idfrmconsulta2origen,idfrmconsultaorigen:i[r].idfrmconsultaorigen,usarunaves:i[r].usarunaves,idcampofiltro:i[r].idcampofiltro,idcampofiltro2:i[r].idcampofiltro2,idcampofiltromanual:i[r].idcampofiltromanual,regitrosacumulados:this.regitrosacumulados,frmapirest:i[r].frmapirest,idfrmconsultaorigenpapa:i[r].idfrmconsultaorigenpapa,idfrmconsultaorigenpapa2:i[r].idfrmconsultaorigenpapa2,idcampofiltropapa:i[r].idcampofiltropapa}),this.datosreghtml=this.datosreghtml+"<strong>"+i[r].title+"</strong>: "+c+"<br>"):a.push({modopxc:this.modopcx,siimagenlocal:this.userinfo[0].idempresa.siimagenes,titulo1:this.titulo1,titulo2:this.titulo2,papaorigen:this.dataitem.papaorigen,secuenciag:this.dataitem.sequenciag,secuencia:this.dataitem.sequencia,idticket:this.dataitem._id,idformulario:this.idformulario,idcampo:i[r]._id,actualiza:"si",order:i[r].order,name:i[r].name,type:i[r].type,required:""+m,placeholder:i[r].placeholder,display:i[r].display,selected:i[r].selected,disabled:""+l,hidden:""+p,title:o,position:i[r].position,labelsizefondt:i[r].labelsizefondt,default:i[r].default,valor:c,default2:i[r].default2,default3:i[r].default3,copiarencampo:i[r].copiarencampo,categoria:i[r].categoria,combofijo:i[r].combofijo,idcadmovil:this.tt,options:i[r].options,fondoetiqueta:i[r].fondoetiqueta,coloretiqueta:i[r].coloretiqueta,blike:i[r].blike,rangomin:i[r].rangomin,rangomax:i[r].rangomax,rangostep:i[r].rangostep,alfatypo2:i[r].alfatypo2,alfatypo:i[r].alfatypo,idfrmconsulta:"",idfrmconsulta2:"",idfrmconsulta2origen:"",idfrmconsultaorigen:"",usarunaves:"",idcampofiltro:"",idcampofiltro2:"",idcampofiltromanual:"",regitrosacumulados:"",frmapirest:"",idfrmconsultaorigenpapa:"",idcampofiltropapa:""}),this.datosreghtml=this.datosreghtml+"<strong>"+i[r].title+"</strong>: "+c+"<br>"}this.controls=this.controlsService.getControls(a),this.muestrabien="ejecutadas"!==this.vista},e=>{this.authenticationService.presentAlert(e.error,"Precauci\xf3n","")}))}gruposusuarios2(e,a,i,o){return(0,v.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({cssClass:"my-custom-class",header:this.authenticationService.datraduccion("selec_usuorden"),inputs:e,buttons:[{text:this.authenticationService.datraduccion("cancelar"),role:"cancelar",cssClass:"secondary",handler:s=>{}},{text:this.authenticationService.datraduccion("aceptar"),handler:s=>{this.submitForm(i,s.split("\xac")[0],"enviausuario",s.split("\xac")[1],s.split("\xac")[2],s.split("\xac")[3])}}]})).present()})}gruposusuario(e,a,i,o){return(0,v.mG)(this,void 0,void 0,function*(){"ASIGNACI\xd3N GRUPO USUARIOS"===o?this.gruposusuario0a(e,a,i,o):this.gruposusuario0b(e,a,i,o)})}gruposusuario0a(e,a,i,o){return(0,v.mG)(this,void 0,void 0,function*(){this.datosusuario=a,yield(yield this.alertController.create({cssClass:"my-custom-class",header:this.authenticationService.datraduccion("sel_grupo_usu"),inputs:e,buttons:[{text:this.authenticationService.datraduccion("enviar_grupo_usu"),cssClass:"secondary",handler:s=>{this.submitForm(i,s.split("\xac")[1],"enviagrupousuario",s.split("\xac")[2],s.split("\xac")[3],s.split("\xac")[4])}},{text:this.authenticationService.datraduccion("cancelar"),role:"cancelar",cssClass:"secondary",handler:s=>{}}]})).present()})}gruposusuario0b(e,a,i,o){return(0,v.mG)(this,void 0,void 0,function*(){this.datosusuario=a,yield(yield this.alertController.create({cssClass:"my-custom-class",header:this.authenticationService.datraduccion("sel_grupo_usu0"),inputs:e,buttons:[{text:this.authenticationService.datraduccion("cancelar"),role:"cancelar",cssClass:"secondary",handler:s=>{}},{text:this.authenticationService.datraduccion("sel_usua_grupo3"),handler:s=>{var d=[];e=this.datosusuario;for(let l=0;l<e.length;l++)if(s.split("\xac")[0]===e[l]._id){var c;c=e[l].usuarios;for(let n=0;n<c.length;n++)d.push({name:c[n].nombre,type:"radio",label:c[n].nombre,value:c[n].email+"\xac"+c[n].correo+"\xac"+c[n].nombre+"\xac"+e[l]._id})}this.gruposusuarios2(d,"1",i,o)}}]})).present()})}submitForm0(){return(0,v.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({cssClass:"my-custom-class",header:this.authenticationService.datraduccion("sel_opcion"),inputs:this.botonesactividad,buttons:[{text:this.authenticationService.datraduccion("cancelar"),role:"cancel",cssClass:"secondary",handler:a=>{}},{text:this.authenticationService.datraduccion("aceptar"),handler:a=>{this.actsiguiente=this.daactividadsiguiente(a.actividadsiguiente.id,this.actividades),"ASIGNACI\xd3N GRUPO USUARIOS"===a.tipo||"ASIGNACI\xd3N USUARIO"===a.tipo||"ASIGNACI\xd3N"===a.tipo?"INVALID"===this.form.status?this.authenticationService.presentAlert("Ingrese todos los campos requeridos en el formulario","Precauci\xf3n",""):this.authenticationService.getReg("todos/Activo/"+this.userinfo[0].idempresa._id+"/"+this.actsiguiente.actor.id,"frmactorgrupos",0).then(i=>{var o,r=[];o=i;for(let l=0;l<o.length;l++){var s=o[l].usuarios,d="",c="";for(let n=0;n<s.length;n++)d=d+s[n].email+"\xb0",c=c+s[n].correo+";";r.push({name:o[l].nombre,type:"radio",label:o[l].nombre,value:o[l]._id+"\xac"+d+"\xac"+c+"\xac"+o[l].nombre+"\xac"+o[l]._id})}this.gruposusuario(r,o,a,a.tipo)},i=>{this.authenticationService.presentAlert(i.error,this.msg,"")}):this.authenticationService.getReg("todos/Activo/"+this.userinfo[0].idempresa._id+"/"+this.actsiguiente.actor.id,"frmactorgrupos",0).then(i=>{var o;o=i;var s="",d="";for(let l=0;l<o.length;l++){var c=o[l].usuarios;for(let n=0;n<c.length;n++)s=s+c[n].email+"\xb0",d=d+c[n].correo+";"}this.submitForm(a,s,"normal",d,"","")})}}]})).present()})}pruebarr(){this.router.navigate(["formulariomovilsdprocesoListPage"]),this.authenticationService.retornaordenes()}objectToArray(e){var a=[];for(var i in e)a.push([i,e[i]]);return a}objToString(e,a){var i=this.objectToArray(e),o=this.objectToArray(a),r="";for(let s=0;s<i.length;s++)for(let d=0;d<o.length;d++)i[s][0]===o[d][0]&&String(i[s][1])!==String(o[d][1])&&(r=r+i[s][0]+": "+i[s][1]+" \xb0 ");return r}submitForm(e,a,i,o,r,s){if("INVALID"===this.form.status)this.authenticationService.presentAlert("Ingrese todos los campos requeridos en el formulario","Precauci\xf3n","");else{let q="Actualiza";for(let g=0;g<this.fechascompone.length;g++)this.submitted[this.fechascompone[g]]=this.authenticationService.dafecha(this.submitted[this.fechascompone[g]],2);for(let g=0;g<this.horascompone.length;g++);if(null==this.dataitem&&(q="Crea"),null!=this.dataitem){this.actsiguiente=this.daactividadsiguiente(e.actividadsiguiente.id,this.actividades);var c=this.dagruposasignados(this.actsiguiente.actor.id,this.actorcorreo);""!==s&&(c=[s]);var l=this.objToString(this.submitted,this.dataitem);this.submitted.usuarioup=this.userinfo[0].email,this.submitted.usuarioup2=this.userinfo[0].nombrealias,this.submitted.idempresa=this.userinfo[0].idempresa._id,this.submitted.geoposicionxxx=this.geoposiciontxt,this.submitted.estadointerno="activo",this.submitted.comentarioanulado="",this.submitted.comentariocerrado="",this.submitted.idusuariosasigna="enviausuario"==i||"enviagrupousuario"==i?a.split("\xb0"):"EJECUCI\xd3N (OBTENER USUARIO PUBLICO)"===e.tipo?this.ususariopublico.split("\xb0"):"normal"==i?a.split("\xb0"):[],this.submitted.ejecutainicio=e.ejecutainicio,this.submitted.ejecutafinal=e.ejecuta,this.submitted.grupoasignado=c,this.submitted.asignadoxxx=""===r||void 0===r?e.asignadoxxx:r,this.submitted.idactividadxxx=e.actividadsiguiente.id,this.submitted.estadoxxx=e.estado,this.submitted.actividadxxx=e.actividadsiguiente.nombre,this.submitted.idaccionxxx=e._id,this.submitted.accionxxx=e.nombre,this.submitted.tipoaccionxxx=e.tipo,this.submitted.subtipoaccionxxx=e.subtipo;for(var n=this.dataitem.pmodulo,u=[],p=0;p<n.length;p++)u.push(n[p][0]);n.push(this.userinfo[0]._id),this.submitted.pmodulo=n,this.submitted.idactorxxx=this.actsiguiente.actor.id,this.submitted.actorxxx=this.actsiguiente.actor.nombre,this.submitted.actividadclasexxx=this.actsiguiente.clase,this.submitted.actividadtipoxxx=this.actsiguiente.tipo,this.submitted.leidoxxx=!1,this.submitted.enviadoporxxx=this.userinfo[0].nombre+"  ("+this.userinfo[0].email+")";var m="activa";"FINAL"!==this.actsiguiente.clase?this.submitted.estadoordenxxx="activa":(this.submitted.estadoordenxxx="cerrada",this.submitted.estadointerno="Cerrado",m="cerrada");var f=this.objectToArray(this.submitted),y=this.objectToArray(this.dataitem),A="";for(let b=0;b<f.length;b++)for(let C=0;C<y.length;C++)f[b][0]===y[C][0]&&f[b][1]===y[C][1]&&(A=A+f[b][0]+"\xb0");const g={idcat:this.idcategoria,idform:this.idformulario,estructura:this.submitted,norequeridospp:this.norequeridospp,tipo:this.tipo,tipo2:this.tipo2,ejecuta:e.ejecuta,ejecutainicio:e.ejecutainicio,ejecutaactualiza:this.ejecutaactualiza,estructuraante:this.dataitem,sequenciag:this.dataitem.sequenciag,sequencia:this.dataitem.sequencia,nocambio:A,trayectoria:{idempresa:this.userinfo[0].idempresa._id,idorden:"idorden",ususariopublico:this.ususariopublico,ususariopublico2:this.ususariopublico2,procedimiento:this.nidformulario,usuariocreador:{id:this.userinfo[0]._id,nombre:this.userinfo[0].nombre,email:this.userinfo[0].email,usuarionew2:this.userinfo[0].nombrealias},estadoxxx:e.estado,enviadoporxxx:this.userinfo[0].nombre+"  ("+this.userinfo[0].email+")",grupoasignado:c,minutos:0,tipocreacionorden:this.actsiguiente.clase,nombre:"nombre",idform:this.idformulario,tipoform:this.tipo,salioorden:1,fecha:this.dataitem.createdAt,asignadoxxx:r,tipo2form:this.tipo2,ejecuta:this.ejecuta,categoriaform:this.idcategoria,idactividad:e.actividadsiguiente.id,actoractividad:{id:this.actsiguiente.actor.id,nombre:this.actsiguiente.actor.nombre},claseactividad:this.actsiguiente.clase,nombreactividad:this.actsiguiente.nombre,tipoactividad:this.actsiguiente.tipo,etapaactividad:this.actsiguiente.etapa,info:this.authenticationService.replaceAll(this.datosreghtml+"~"+l,'"',""),estadoorden:m,idaccion:e._id,tipoaccion:e.tipo,subtipoaccion:e.subtipo,nombreaccion:e.nombre,estadoaccion:e.estado,actividadsiguienteaccion:{id:e.actividadsiguiente.id,nombre:e.actividadsiguiente.nombre}},bitacora:{idempresa:this.userinfo[0].idempresa._id,idafiliado:"",email:this.userinfo[0].email,permiso:q,accion:"Actualiza en formulario movil"}};g&&this.authenticationService.createRegmovil(this.dataitem._id,g,"frmmovils").then(b=>{this.terminacreacion(e,i,o,b)},b=>{b.error.indexOf("Precauci\xf3n registro ya existe en base de datos, este formulario tiene llaves unicas:")>=0?(this.terminacreacion(e,i,o,[]),this.authenticationService.presentAlert(b.error,"Precauci\xf3n","")):this.authenticationService.presentAlert(b.error,"Precauci\xf3n","")})}}}back(){"si"===this.cerrarxxx?this.router.navigate(["frmordencomponenteListPage"]):this.grabar("regresar")}terminacreacion(e,a,i,o){var r=[];if(o===[])if("false"===e.mandacorreo)this.router.navigate(["formulariomovilsdprocesoListPage"],{state:{user:"1"}}),this.authenticationService.retornaordenes();else{let u="";for(let m=0;m<this.actorcorreo.length;m++)if(this.actorcorreo[m].idpapa===this.actsiguiente.actor.id){var s=this.actorcorreo[m].usuarios;for(let f=0;f<s.length;f++)u="USUARIOSOLICITANTE"===s[f].correo?u+this.userinfo[0].correonotifica+";":u+s[f].correo+";"}"EJECUCI\xd3N (OBTENER USUARIO PUBLICO)"===e.tipo&&(u=this.ususariopublico2+";"),"normal"===a?u+=e.notificacionemail:u=i+";"+e.notificacionemail,u=u.replace("USUARIOSOLICITANTE",this.dataitem.usuarionew);let p='<html><body><p style="text-align: center;"><img src="'+this.apifoto+this.userinfo[0].idempresa.foto0+' alt="" width="300" height="200" /></p>      <p style="text-align: left;"><strong>PROCESSAPPS '+this.userinfo[0].idempresa.nombre+'</strong></p>      <p style="text-align: left;">Tienes una solicitud de un nuevo requerimiento:</p>       <p style="text-align: left;"><strong>Proceso</strong>:&nbsp; '+this.nidformulario+'</p>       <p style="text-align: left;"><strong>Actividad actual</strong>: '+this.actsiguiente.nombre+'</p>       <p style="text-align: left;"><strong>mensaje</strong>:'+e.notificacionmsm+"</p>      <p>&nbsp;</p>      <p>&nbsp;</p>      <p>saludos</p></body> </html>";var c=u.split(";").filter(function(m){return""!==m}),l="",n={};"GMAIL"===this.userinfo[0].idempresa.tipocorreo&&(l="crea/1/GMAIL",n={destino:c,html:p,text:p,segurocorreo:this.userinfo[0].idempresa.segurocorreo,tlscorreo:this.userinfo[0].idempresa.tlscorreo,origencorreo:this.userinfo[0].idempresa.origencorreo,clavecorreo:this.userinfo[0].idempresa.clavecorreo,puertocorreo:this.userinfo[0].idempresa.puertocorreo,subjet:e.notificacionmsm+"- PROCESSAPPS "+this.userinfo[0].idempresa.nombre,actualiza:{tipo:"na",id:"1",estado:"Ingreso, mail enviado",otros:""}}),"OFFICE365"===this.userinfo[0].idempresa.tipocorreo&&(l="crea/1/OFFICE365",n={destino:c,html:p,text:p,segurocorreo:this.userinfo[0].idempresa.segurocorreo,tlscorreo:this.userinfo[0].idempresa.tlscorreo,origencorreo:this.userinfo[0].idempresa.origencorreo,clavecorreo:this.userinfo[0].idempresa.clavecorreo,puertocorreo:this.userinfo[0].idempresa.puertocorreo,subjet:e.notificacionmsm+"- PROCESSAPPS "+this.userinfo[0].idempresa.nombre,actualiza:{tipo:"na",id:"1",estado:"Ingreso, mail enviado",otros:""}}),("SES"===this.userinfo[0].idempresa.tipocorreo||"NA"===this.userinfo[0].idempresa.tipocorreo)&&(l="",n={destino:u,html:p,text:p,subjet:e.notificacionmsm+"- PROCESSAPPS "+this.userinfo[0].idempresa.nombre,actualiza:{tipo:"na",id:"1",estado:"Ingreso, mail enviado",otros:""}}),this.authenticationService.mandamail(l,n,"mails").then(m=>{this.router.navigate(["formulariomovilsdprocesoListPage"]),this.authenticationService.retornaordenes()},m=>{this.authenticationService.presentAlert("Problema con envio de correo en servidor","Precauci\xf3n",""),this.router.navigate(["formulariomovilsdprocesoListPage"]),this.authenticationService.retornaordenes()})}else{const u={operacion:"actualizaordentrayectoria",idtrayectoria:(r=o)._id,idmovil:this.dataitem._id,fechaactual:r.createdAt,usuarioejecutor:{id:this.userinfo[0]._id,nombre:this.userinfo[0].nombre,email:this.userinfo[0].email,usuarionew2:this.userinfo[0].nombrealias}};u&&this.authenticationService.createRegmovil(this.dataitem._id,u,"frmmovils").then(p=>{if("false"===e.mandacorreo)this.router.navigate(["formulariomovilsdprocesoListPage"],{state:{user:"1"}}),this.authenticationService.retornaordenes();else{let g="";for(let C=0;C<this.actorcorreo.length;C++)if(this.actorcorreo[C].idpapa===this.actsiguiente.actor.id){var m=this.actorcorreo[C].usuarios;for(let P=0;P<m.length;P++)g="USUARIOSOLICITANTE"===m[P].correo?g+this.userinfo[0].correonotifica+";":g+m[P].correo+";"}"EJECUCI\xd3N (OBTENER USUARIO PUBLICO)"===e.tipo&&(g=this.ususariopublico2+";"),"normal"===a?g+=e.notificacionemail:g=i+";"+e.notificacionemail,g=g.replace("USUARIOSOLICITANTE",this.dataitem.usuarionew);let b='<html><body><p style="text-align: center;"><img src="'+this.apifoto+this.userinfo[0].idempresa.foto0+' alt="" width="300" height="200" /></p>      <p style="text-align: left;"><strong>PROCESSAPPS '+this.userinfo[0].idempresa.nombre+'</strong></p>      <p style="text-align: left;">Tienes una solicitud de un nuevo requerimiento:</p>       <p style="text-align: left;"><strong>Proceso</strong>:&nbsp; '+this.nidformulario+'</p>       <p style="text-align: left;"><strong>Actividad actual</strong>: '+this.actsiguiente.nombre+'</p>       <p style="text-align: left;"><strong>mensaje</strong>:'+e.notificacionmsm+"</p>      <p>&nbsp;</p>      <p>&nbsp;</p>      <p>saludos</p></body> </html>";var y=g.split(";").filter(function(C){return""!==C}),A="",q={};"GMAIL"===this.userinfo[0].idempresa.tipocorreo&&(A="crea/1/GMAIL",q={destino:y,html:b,text:b,segurocorreo:this.userinfo[0].idempresa.segurocorreo,tlscorreo:this.userinfo[0].idempresa.tlscorreo,origencorreo:this.userinfo[0].idempresa.origencorreo,clavecorreo:this.userinfo[0].idempresa.clavecorreo,puertocorreo:this.userinfo[0].idempresa.puertocorreo,subjet:e.notificacionmsm+"- PROCESSAPPS "+this.userinfo[0].idempresa.nombre,actualiza:{tipo:"na",id:"1",estado:"Ingreso, mail enviado",otros:""}}),"OFFICE365"===this.userinfo[0].idempresa.tipocorreo&&(A="crea/1/OFFICE365",q={destino:y,html:b,text:b,segurocorreo:this.userinfo[0].idempresa.segurocorreo,tlscorreo:this.userinfo[0].idempresa.tlscorreo,origencorreo:this.userinfo[0].idempresa.origencorreo,clavecorreo:this.userinfo[0].idempresa.clavecorreo,puertocorreo:this.userinfo[0].idempresa.puertocorreo,subjet:e.notificacionmsm+"- PROCESSAPPS "+this.userinfo[0].idempresa.nombre,actualiza:{tipo:"na",id:"1",estado:"Ingreso, mail enviado",otros:""}}),("SES"===this.userinfo[0].idempresa.tipocorreo||"NA"===this.userinfo[0].idempresa.tipocorreo)&&(A="",q={destino:g,html:b,text:b,subjet:e.notificacionmsm+"- PROCESSAPPS "+this.userinfo[0].idempresa.nombre,actualiza:{tipo:"na",id:"1",estado:"Ingreso, mail enviado",otros:""}}),this.authenticationService.mandamail(A,q,"mails").then(C=>{this.router.navigate(["formulariomovilsdprocesoListPage"]),this.authenticationService.retornaordenes()},C=>{this.authenticationService.presentAlert("Problema con envio de correo en servidor","Precauci\xf3n",""),this.router.navigate(["formulariomovilsdprocesoListPage"]),this.authenticationService.retornaordenes()})}},p=>{this.authenticationService.presentAlert(p.error,"Precauci\xf3n","")})}}devuelvenorden(e){return(0,v.mG)(this,void 0,void 0,function*(){var a=e.actividad;if(void 0===a)return null;{let p="Actualiza";for(let f=0;f<this.fechascompone.length;f++)this.submitted[this.fechascompone[f]]=this.authenticationService.dafecha(this.submitted[this.fechascompone[f]],2);for(let f=0;f<this.horascompone.length;f++);null==this.dataitem&&(p="Crea");var i=this.dataitem.pmodulo,o=[],r=[];this.dataitem.secuenciags?((o=this.dataitem.secuenciags).push(this.dataitem.sequenciag),(r=this.dataitem.idants).push(this.dataitem._id)):(o.push(this.dataitem.sequenciag),r.push(this.dataitem._id));for(var s=[],d=0;d<i.length;d++)s.push(i[d][0]);i.push(this.userinfo[0]._id);var u,c=this.objectToArray(this.submitted),l=this.objectToArray(this.dataitem),n="";for(let f=0;f<c.length;f++)for(let y=0;y<l.length;y++)c[f][0]===l[y][0]&&c[f][1]===l[y][1]&&(n=n+c[f][0]+"\xb0");this.submitted.usuarionew=this.userinfo[0].email,this.submitted.usuarioup=this.userinfo[0].email,this.submitted.usuarioup2=this.userinfo[0].nombrealias,this.submitted.usuarionew2=this.userinfo[0].nombrealias,this.submitted.idempresa=this.userinfo[0].idempresa._id,this.submitted.geoposicionxxx=this.geoposiciontxt,this.submitted.secuenciagants=o,this.submitted.idanst=r,this.submitted.estadointerno="activo",this.submitted.comentarioanulado="",this.submitted.comentariocerrado="",this.actactualtemp=this.daactividadactual2(a,this.actividades);for(let f=0;f<this.acciones.length;f++)if(this.acciones[f].estado===this.actactualtemp.nombre){u=this.acciones[f];break}return this.submitted.pmodulo=this.userinfo[0]._id,this.submitted.idactividadxxx=u.actividadsiguiente.id,this.submitted.estadoxxx=u.estado,this.submitted.ejecutainicio=u.ejecutainicio,this.submitted.ejecutafinal=u.ejecuta,this.submitted.actividadxxx=u.actividadsiguiente.nombre,this.submitted.idaccionxxx=u._id,this.submitted.accionxxx=u.nombre,this.submitted.tipoaccionxxx=u.tipo,this.submitted.subtipoaccionxxx=u.subtipo,this.actsiguiente=this.daactividadsiguiente(u.actividadsiguiente.id,this.actividades),this.submitted.idactorxxx=this.actsiguiente.actor.id,this.submitted.actorxxx=this.actsiguiente.actor.nombre,this.submitted.actividadclasexxx=this.actsiguiente.clase,this.submitted.actividadtipoxxx=this.actsiguiente.tipo,this.submitted.leidoxxx=!1,this.submitted.enviadoporxxx=this.userinfo[0].nombre+"  ("+this.userinfo[0].email+")",this.submitted.estadoordenxxx="activa",{operacion:"actualizasimple",idcat:this.idcategoria,idform:this.dataitem._id,formulario:this.idformulario,estructura:this.submitted,norequeridospp:this.norequeridospp,tipo:this.tipo,tipo2:this.tipo2,sequenciag:this.dataitem.sequenciag,sequencia:this.dataitem.sequencia,nocambio:n,trayectoria:{idempresa:this.userinfo[0].idempresa._id,idorden:"idorden",idordeng:"idordeng",procedimiento:this.nidformulario,usuariocreador:{id:this.userinfo[0]._id,nombre:this.userinfo[0].nombre,email:this.userinfo[0].email,usuarionew2:this.userinfo[0].nombrealias},estadoxxx:u.estado,enviadoporxxx:this.userinfo[0].nombre+"  ("+this.userinfo[0].email+")",minutos:1,tipocreacionorden:"INICIAL",nombre:"nombre",idform:this.idformulario,tipoform:this.tipo,tipo2form:this.tipo2,ejecuta:this.ejecuta,categoriaform:this.idcategoria,fecha:this.dataitem.createdAt,idactividad:u.actividadsiguiente.id,actoractividad:{id:this.actsiguiente.actor.id,nombre:this.actsiguiente.actor.nombre},claseactividad:this.actsiguiente.clase,info:this.authenticationService.replaceAll(this.datosreghtml,'"',""),nombreactividad:this.actsiguiente.nombre,tipoactividad:this.actsiguiente.tipo,etapaactividad:this.actsiguiente.etapa,salioorden:1,estadoorden:"activa",idaccion:u._id,tipoaccion:u.tipo,subtipoaccion:u.subtipo,nombreaccion:u.nombre,estadoaccion:u.estado,secuenciagants:o,idanst:r,actividadsiguienteaccion:{id:u.actividadsiguiente.id,nombre:u.actividadsiguiente.nombre}},bitacora:{idempresa:this.userinfo[0].idempresa._id,idafiliado:"",email:this.userinfo[0].email,permiso:p,accion:"Crea nueva orden"}}}})}grabar(e){let a="Actualiza";for(let l=0;l<this.fechascompone.length;l++)this.submitted[this.fechascompone[l]]=this.authenticationService.dafecha(this.submitted[this.fechascompone[l]],2);if(null==this.dataitem&&(a="Crea"),null!==this.dataitem){for(var i=this.dataitem.pmodulo,o=[],r=0;r<i.length;r++)o.push(i[r][0]);i.push(this.userinfo[0]._id);var s=this.objectToArray(this.submitted),d=this.objectToArray(this.dataitem),c="";for(let n=0;n<s.length;n++)for(let u=0;u<d.length;u++)s[n][0]===d[u][0]&&s[n][1]===d[u][1]&&(c=c+s[n][0]+"\xb0");const l={operacion:"actualizasimple",idcat:this.idcategoria,idform:this.dataitem._id,formulario:this.idformulario,estructura:this.submitted,norequeridospp:this.norequeridospp,tipo:this.tipo,tipo2:this.tipo2,nocambio:c,bitacora:{idempresa:this.userinfo[0].idempresa._id,idafiliado:"",email:this.userinfo[0].email,permiso:a,accion:"Actualiza en formulario movil"}};l&&this.authenticationService.createRegmovil(this.dataitem._id,l,"frmmovils").then(n=>{"regresar"===e&&this.router.navigate(["formulariomovilsdprocesoListPage"])},n=>{this.authenticationService.presentAlert(n.error,"Precauci\xf3n","")})}}dacomponente(e,a){return(0,v.mG)(this,void 0,void 0,function*(){let i="";"ubicacion"===e&&(i=this.form.controls.ubicacion.value);const o=yield this.modalController.create({component:F.B,swipeToClose:!1,backdropDismiss:!1,animated:!0,presentingElement:yield this.modalController.getTop(),componentProps:{variables:this.variables,record:null,userinfo:this.userinfo,uubx:i},cssClass:"modal-fullscreen"});return o.onWillDismiss().then(r=>{"close"===r.data||("direccion"===e?this.form.controls.direccion.setValue(r.data.direccion):this.form.controls.ubicacion.setValue(r.data.direccion+" {"+r.data.la+"\xb0"+r.data.lo+"}"))}),yield o.present()})}takePicture(e){return(0,v.mG)(this,void 0,void 0,function*(){const a=yield L.V1.getPhoto({correctOrientation:!0,height:200,width:200,quality:60,allowEditing:!0,resultType:L.dk.DataUrl,source:L.oK.Camera});this.authenticationService.generateFromImage(a.dataUrl,200,200,.5,i=>{"fotoa"===e&&(this.fotoimg=i,this.form.controls.foto.setValue(this.authenticationService.procesafoto(this.form.controls.foto.value)))})})}uploadPWA2(e,a){a&&a.length>0&&this.firstFileToBase64(a[0]).then(o=>{this.authenticationService.generateFromImage(o,200,300,.5,r=>{"fotoa"===e&&(this.fotoimg=r,this.form.controls.foto.setValue(this.authenticationService.procesafoto(this.form.controls.foto.value)))})},o=>{"fotoa"===e&&(this.fotoimg=null,this.form.controls.foto1.setValue(""))})}uploadPWA(e){if("fotoa"===e){if(null==this.fotoa)return;this.uploadPWA2(e,this.fotoa.nativeElement.files)}}firstFileToBase64(e){return new Promise((a,i)=>{const o=new FileReader;o&&null!=e?(o.readAsDataURL(e),o.onload=()=>{a(o.result)},o.onerror=r=>{i(r)}):i(new Error("No file found"))})}takePicture2(e){return(0,v.mG)(this,void 0,void 0,function*(){"fotoa"===e&&this.fotoa.nativeElement.click()})}fotodatos(e){return(0,v.mG)(this,void 0,void 0,function*(){yield(yield this.actionSheetController.create({header:"Foto",cssClass:"my-custom-class",buttons:[{text:"Galeria",role:"destructive",icon:"image-outline",handler:()=>{this.takePicture2(e)}},{text:"Camara",icon:"camera-outline",handler:()=>{this.takePicture(e)}}]})).present()})}moverorden(e,a,i){return(0,v.mG)(this,void 0,void 0,function*(){var o;for(let m=0;m<this.fechascompone.length;m++)this.submitted[this.fechascompone[m]]=this.authenticationService.dafecha(this.submitted[this.fechascompone[m]],2);for(let m=0;m<this.acciones.length;m++)if(this.acciones[m].actividadsiguiente.id===e){o=this.acciones[m];break}this.actsiguiente=this.daactividadactual2(e,this.actividades),this.submitted.usuarioup=this.userinfo[0].email,this.submitted.usuarioup2=this.userinfo[0].nombrealias,this.submitted.idempresa=this.userinfo[0].idempresa._id,this.submitted.geoposicionxxx=this.geoposiciontxt,this.submitted.estadointerno=a,this.submitted.comentarioanulado="",this.submitted.comentariocerrado="",this.submitted.ejecutainicio=o.ejecutainicio,this.submitted.ejecutafinal=o.ejecuta,this.submitted.idactividadxxx=o.actividadsiguiente.id,this.submitted.estadoxxx=o.estado,this.submitted.actividadxxx=o.actividadsiguiente.nombre,this.submitted.idaccionxxx=o._id,this.submitted.accionxxx=o.nombre,this.submitted.tipoaccionxxx=o.tipo,this.submitted.subtipoaccionxxx=o.subtipo;for(var r=this.dataitem.pmodulo,s=[],d=0;d<r.length;d++)s.push(r[d][0]);r.push(this.userinfo[0]._id),this.submitted.pmodulo=r,this.actsiguiente=this.daactividadsiguiente(o.actividadsiguiente.id,this.actividades),this.submitted.idactorxxx=this.actsiguiente.actor.id,this.submitted.actorxxx=this.actsiguiente.actor.nombre,this.submitted.actividadclasexxx=this.actsiguiente.clase,this.submitted.actividadtipoxxx=this.actsiguiente.tipo,this.submitted.leidoxxx=!1,this.submitted.enviadoporxxx=this.userinfo[0].nombre+"  ("+this.userinfo[0].email+")","FINAL"!==this.actsiguiente.clase?this.submitted.estadoordenxxx="activa":(this.submitted.estadoordenxxx="cerrada",this.submitted.estadointerno="Cerrado");var l=this.objectToArray(this.submitted),n=this.objectToArray(this.dataitem),u="";for(let m=0;m<l.length;m++)for(let f=0;f<n.length;f++)l[m][0]===n[f][0]&&l[m][1]===n[f][1]&&(u=u+l[m][0]+"\xb0");const p={idcat:this.idcategoria,idform:this.idformulario,estructura:this.submitted,norequeridospp:this.norequeridospp,tipo:this.tipo,tipo2:this.tipo2,estructuraante:this.dataitem,sequenciag:this.dataitem.sequenciag,sequencia:this.dataitem.sequencia,trayectoria:{idempresa:this.userinfo[0].idempresa._id,idorden:"idorden",procedimiento:this.nidformulario,usuariocreador:{id:this.userinfo[0]._id,nombre:this.userinfo[0].nombre,email:this.userinfo[0].email,usuarionew2:this.userinfo[0].nombrealias},estadoxxx:o.estado,enviadoporxxx:this.userinfo[0].nombre+"  ("+this.userinfo[0].email+")",minutos:1,tipocreacionorden:this.actsiguiente.clase,nombre:"nombre",idform:this.idformulario,tipoform:this.tipo,salioorden:1,tipo2form:this.tipo2,ejecuta:this.ejecuta,categoriaform:this.idcategoria,fecha:this.dataitem.createdAt,idactividad:o.actividadsiguiente.id,actoractividad:{id:this.actsiguiente.actor.id,nombre:this.actsiguiente.actor.nombre},claseactividad:this.actsiguiente.clase,nombreactividad:this.actsiguiente.nombre,tipoactividad:this.actsiguiente.tipo,info:this.authenticationService.replaceAll(this.datosreghtml,'"',""),etapaactividad:this.actsiguiente.etapa,estadoorden:"activa",idaccion:o._id,tipoaccion:o.tipo,subtipoaccion:o.subtipo,nombreaccion:o.nombre,estadoaccion:o.estado,actividadsiguienteaccion:{id:o.actividadsiguiente.id,nombre:o.actividadsiguiente.nombre}},bitacora:{idempresa:this.userinfo[0].idempresa._id,idafiliado:"",email:this.userinfo[0].email,permiso:"Actualiza",accion:"Reasignaci\xf3n orden"}};p&&this.authenticationService.createRegmovil(this.dataitem._id,p,"frmmovils").then(m=>{this.router.navigate(["formulariomovilsdprocesoListPage"]),this.authenticationService.retornaordenes()},m=>{this.router.navigate(["formulariomovilsdprocesoListPage"]),this.authenticationService.retornaordenes()})})}combodatos(e,a,i,o,r,s){return(0,v.mG)(this,void 0,void 0,function*(){var d;d="actividadsiguiente-plantilla"===a?"Seleccione actividad para reasignaci\xf3n ":"Buscar "+r;const c=yield this.modalController.create({component:R.j,swipeToClose:!1,backdropDismiss:!1,animated:!0,presentingElement:yield this.modalController.getTop(),componentProps:{doble:"",grabax:s,variables:this.variables,userinfo:this.userinfo,bloquear:this.actactual._id,record2:null,op:a,frm:i,idllave0:this.idformulario,idllave:this.actactual._id,titlex:d},cssClass:"modal-fullscreen"});return c.onWillDismiss().then(l=>{let n=[];n=l,"close"!==n.data&&("actividadsiguiente-plantilla"===a?this.moverorden(n.data._id,"activo",""):this.form.controls[o].setValue(n.data?n.data.nombre:""))}),yield c.present()})}otrasop2(){return(0,v.mG)(this,void 0,void 0,function*(){yield(yield this.alertController.create({cssClass:"my-custom-class",header:this.authenticationService.datraduccion("ingrese_detalle"),inputs:this.items2,buttons:[{text:this.authenticationService.datraduccion("cancelar"),role:"cancel",cssClass:"secondary",handler:a=>{}},{text:this.authenticationService.datraduccion("aceptar"),handler:a=>{const i=a.split("\xb0");"Check List Detalle"===i[4]?this.combodatoscheck0(this.idformulario,this.dataitem,i[0],i[3]):this.authenticationService.getReg(i[1],"frmmovils",0).then(o=>{this.authenticationService.getReg(i[1]+"/formulariocamposver/"+this.userinfo[0].idempresa._id,"frmmovils",0).then(r=>{var s;for(let d=0;d<this.camposdetallepermisos.length;d++)if(this.camposdetallepermisos[d].campo.id===o[0]._id){s=this.camposdetallepermisos[d];break}this.authenticationService.getReg("todos/permisos/"+this.userinfo[0].idempresa._id+"/"+i[1]+"/"+this.userinfo[0]._id,"formulariousrds",0).then(d=>{var c;c=d.length>0?{acciones:d[0].acciones,master:this.dahtml,activas:d[0].activas,anularorden:d[0].anularorden,cerradas:d[0].cerradas,comentariosorden:d[0].comentariosorden,documentacionorden:d[0].documentacionorden,documentosorden:d[0].documentosorden,ejecutadas:d[0].ejecutadas,eliminaorden:d[0].eliminaorden,filtrarorden:d[0].filtrarorden,estadomaster:"Activo",finalizaorden:d[0].finalizaorden,fotosorden:d[0].fotosorden,generareporte:d[0].generareporte,imprimeorden:d[0].imprimeorden,pactualizacion:d[0].actualizacion,pausarorden:d[0].pausarorden,pconsulta:d[0].consulta,pcreacion:d[0].creacion,peliminacion:d[0].eliminacion,pfiltro:d[0].filtro,pingreso:d[0].ingreso,potros1:"",publico:d[0].publico,tareasorden:d[0].tareasorden,trayectoriaorden:d[0].trayectoriaorden}:{acciones:this.variables.acciones,master:this.dahtml,activas:this.variables.activas,anularorden:this.variables.anularorden,cerradas:this.variables.cerradas,comentariosorden:this.variables.comentariosorden,documentacionorden:this.variables.documentacionorden,documentosorden:this.variables.documentosorden,ejecutadas:this.variables.ejecutadas,eliminaorden:this.variables.eliminaorden,filtrarorden:this.variables.filtrarorden,estadomaster:"activo",finalizaorden:this.variables.finalizaorden,fotosorden:this.variables.fotosorden,generareporte:this.variables.generareporte,imprimeorden:this.variables.imprimeorden,imprimeorden2:this.variables.imprimeorden2,pactualizacion:this.variables.pactualizacion,pausarorden:this.variables.pausarorden,pconsulta:this.variables.pconsulta,pcreacion:this.variables.pcreacion,peliminacion:this.variables.peliminacion,pfiltro:this.variables.pfiltro,pingreso:this.variables.pingreso,potros1:this.variables.potros,publico:this.variables.publico,tareasorden:this.variables.tareasorden,trayectoriaorden:this.variables.trayectoriaorden};const n=[];n.push({tabla:this.nidformulario,idtabla:this.idformulario,item:this.dataitem}),this.router.navigate(["formulariomovilsd2ListPage"],{state:{variables:c,user:null,idllave0:this.dataitem._id,idllave:o[0]._id,datat:r,verregistros:this.verregistros,idcategoria:o[0].categoria,idcampo:i[0],estadomaster:"activo",idformulario:o[0]._id,nidformulario:o[0].nombre,regitrosacumulados:n,tipo2:o[0].tipo2,ejecuta:o[0].ejecuta,tipo:o[0].tipo,permisoscamposfrm:s,title:i[3],rranterior:"",rrsiguiente:"3",noreg:i[5],geoposicion:o[0].geoposicion}})},d=>{this.authenticationService.presentAlert(d.error,this.msg,"")})},r=>{this.authenticationService.presentAlert(r.error,this.msg,"")})},o=>{this.authenticationService.presentAlert(o.error,this.msg,"")})}}]})).present()})}combodatoscheck0(e,a,i,o){return(0,v.mG)(this,void 0,void 0,function*(){let r="";this.authenticationService.getReg(e+"\xb0"+i+"/formulariodidxx/"+this.userinfo[0].idempresa._id,"frmmovils",0).then(s=>{let d;const c=s;for(let n=0;n<c.length;n++){let p="";p="true"===c[n].required?" (*)":" "+this.authenticationService.datraduccion("opcional");let m="";m=this.davaloritem(a,c[n].name),m||(m=""),"label"===c[n].type&&(m=".");var l=c[n].title+p;if("es"!==this.authenticationService.getlenguaje()&&c[n].title2&&(l=c[n].title2+p),"select3"===c[n].type){const f=[];f.push({tabla:this.nidformulario,idtabla:this.idformulario,item:a}),r=c[n].name,d={idformulario:e,idcampo:c[n]._id,actualiza:"si",verregistros:c[n].verregistros,order:c[n].order,name:c[n].name,type:c[n].type,required:c[n].required,placeholder:c[n].placeholder,display:c[n].display,selected:c[n].selected,disabled:c[n].disabled,hidden:c[n].hidden,title:l,position:c[n].position,labelsizefondt:c[n].labelsizefondt,default:"",default2:c[n].default2,default3:c[n].default3,copiarencampo:c[n].copiarencampo,valor:m,categoria:c[n].categoria,combofijo:c[n].combofijo,idcadmovil:"",options:c[n].options,fondoetiqueta:c[n].fondoetiqueta,coloretiqueta:c[n].coloretiqueta,blike:c[n].blike,rangomin:c[n].rangomin,rangomax:c[n].rangomax,rangostep:c[n].rangostep,alfatypo2:c[n].alfatypo2,alfatypo:c[n].alfatypo,idfrmconsulta:c[n].idfrmconsulta,idfrmconsulta2:c[n].idfrmconsulta2,idfrmconsulta2origen:c[n].idfrmconsulta2origen,idfrmconsultaorigen:c[n].idfrmconsultaorigen,usarunaves:c[n].usarunaves,idcampofiltro:c[n].idcampofiltro,idcampofiltro2:c[n].idcampofiltro2,idcampofiltromanual:c[n].idcampofiltromanual,regitrosacumulados:f,idfrmconsultaorigenpapa:c[n].idfrmconsultaorigenpapa,idfrmconsultaorigenpapa2:c[n].idfrmconsultaorigenpapa2,frmapirest:c[n].frmapirest,idcampofiltropapa:c[n].idcampofiltropapa}}}this.combodatoscheck(d,a,o,i,r)},s=>{this.authenticationService.presentAlert(s.error,"Precauci\xf3n","")})})}combodatoscheck(e,a,i,o,r){return(0,v.mG)(this,void 0,void 0,function*(){const s=a;if("no"===e.actualiza)for(let u=0;u<e.regitrosacumulados.length;u++)e.regitrosacumulados[u].idtabla===e.idformulario&&(e.regitrosacumulados[u].item=s);let d="sigraba";"true"===e.combofijo&&(d="nograba");let c="";e.idfrmconsulta&&""!==e.idfrmconsulta.id&&void 0!==e.idfrmconsulta.id&&(c="si",d="formulariott");let l="",n="";if(void 0!==e.idcampofiltro&&""!==e.idcampofiltro){for(let u=0;u<e.regitrosacumulados.length;u++)if(e.regitrosacumulados[u].idtabla===e.idfrmconsultaorigen.id){for(let p=0;p<e.idfrmconsulta2origen.length;p++)n=n+e.idfrmconsulta2origen[p].nombre.split("\xb0")[1]+": "+e.regitrosacumulados[u].item[e.idfrmconsulta2origen[p].nombre.split("\xb0")[0]]+"\xb0";n=n+"\xac"+e.regitrosacumulados[u].item._id}l="Ver solo los mios"===e.verregistros?""!==e.idcampofiltropapa&&void 0!==e.idcampofiltropapa?'"'+e.idcampofiltropapa+'":"'+n+'","usuarionew":"'+this.userinfo[0].email+'"':'"'+e.idcampofiltro+'":"'+n+'","usuarionew":"'+this.userinfo[0].email+'"':""!==e.idcampofiltropapa&&void 0!==e.idcampofiltropapa?'"'+e.idcampofiltropapa+'":"'+n+'"':n.indexOf("\xac")>=0?'"'+e.idcampofiltro+'":{"$regex" : "'+n.split("\xac")[1]+'", "$options" : "i"}':'"'+e.idcampofiltro+'":"'+n+'"'}else"Ver solo los mios"===e.verregistros&&(l='"usuarionew":"'+this.userinfo[0].email+'"');if(""===e.idcampofiltropapa||void 0===e.idcampofiltropapa){const u=yield this.modalController.create({component:R.j,swipeToClose:!1,backdropDismiss:!1,animated:!0,presentingElement:yield this.modalController.getTop(),componentProps:{idcampofiltromanual:e.idcampofiltromanual,tipo:e.type,filtrar:l,idfrmconsulta:e.idfrmconsulta,idfrmconsulta2:e.idfrmconsulta2,siformulatiot:c,variables:"",userinfo:"",grabax:d,vector:e.options,record2:null,op:e.idcampo,frm:"frmcats",idllave:"",titlex:"Buscar "+i},cssClass:"modal-fullscreen"});return u.onWillDismiss().then(p=>{let m=[];m=p,"close"!==m.data&&m.data&&this.authenticationService.getReg(this.idformulario+"/formulariod/"+this.userinfo[0].idempresa._id,"frmmovils",0).then(f=>{const y={},A=f;for(let g=0;g<A.length;g++){const b=A[g].name;let C="";C=this.davaloritem(a,A[g].name),C||(C=""),""!==A[g].type&&(y[b]=b===r?m.data.correos:C)}y.usuarioup=this.userinfo[0].email,y.idempresa=this.userinfo[0].idempresa._id;const q={idcat:this.idcategoria,idform:this.idformulario,estructura:y,bitacora:{idempresa:this.userinfo[0].idempresa._id,idafiliado:"",email:this.userinfo[0].email,permiso:"Actualiza",accion:"Actualiza en formulario movil"}};q&&this.authenticationService.createRegmovil(a._id,q,"frmmovils").then(g=>{},g=>{this.authenticationService.presentAlert(g.error,"Precauci\xf3n","")})})}),yield u.present()}this.authenticationService.getReg(e.idfrmconsultaorigenpapa.id+"/"+l+"/"+this.userinfo[0].idempresa._id+"/formulariosolopapa/","frmmovils",0).then(p=>(0,v.mG)(this,void 0,void 0,function*(){let m=[];"select3"===e.type&&(m=e.valor.split("\xac")[0].split(";"));const f=yield this.modalController.create({component:R.j,swipeToClose:!1,backdropDismiss:!1,animated:!0,presentingElement:yield this.modalController.getTop(),componentProps:{idcampofiltromanual:e.idcampofiltromanual,tarraymultiple:m,tipo:e.type,idpapafiltro:p[0]._id,filtrar:l,idfrmconsulta:e.idfrmconsulta,idfrmconsulta2:e.idfrmconsulta2,siformulatiot:c,variables:"",userinfo:"",grabax:d,vector:e.options,record2:null,op:e.idcampo,frm:"frmcats",idllave:"",titlex:"Buscar "+e.title},cssClass:"modal-fullscreen"});return f.onWillDismiss().then(y=>{let A=[];A=y,"close"!==A.data&&A.data&&this.authenticationService.getReg(this.idformulario+"/formulariod/"+this.userinfo[0].idempresa._id,"frmmovils",0).then(q=>{const g={},b=q;for(let P=0;P<b.length;P++){const Z=b[P].name;let I="";I=this.davaloritem(a,b[P].name),I||(I=""),""!==b[P].type&&(g[Z]=Z===r?A.data.correos+"\xac"+A.data.correos2:I)}g.usuarioup=this.userinfo[0].email,g.idempresa=this.userinfo[0].idempresa._id;const C={idcat:this.idcategoria,idform:this.idformulario,estructura:g,bitacora:{idempresa:this.userinfo[0].idempresa._id,idafiliado:"",email:this.userinfo[0].email,permiso:"Actualiza",accion:"Actualiza en formulario movil"}};C&&this.authenticationService.createRegmovil(a._id,C,"frmmovils").then(P=>{},P=>{this.authenticationService.presentAlert(P.error,"Precauci\xf3n","")})})}),yield f.present()}),p=>{this.authenticationService.presentAlert(p.error,"Precauci\xf3n","")})})}}return h.\u0275fac=function(e){return new(e||h)(t.Y36(S.t4),t.Y36(W.$),t.Y36(T.Ye),t.Y36(S.Dh),t.Y36(S.Br),t.Y36(k.F0),t.Y36(S.IN),t.Y36(H.X),t.Y36(E.sK),t.Y36(U.$),t.Y36(S.BX))},h.\u0275cmp=t.Xpm({type:h,selectors:[["app-formulariomovilsproceso2-create"]],viewQuery:function(e,a){if(1&e&&(t.Gf($,5),t.Gf(tt,7)),2&e){let i;t.iGM(i=t.CRH())&&(a.inputElement=i.first),t.iGM(i=t.CRH())&&(a.fotoa=i.first)}},decls:65,vars:46,consts:[["color","primary"],["slot","start"],[3,"click"],["name","arrow-back"],["size","small"],["collapse","true","slot","end"],[3,"title","click",4,"ngIf"],["slot","secondary"],[3,"title","click"],["slot","icon-only","ios","ellipsis-horizontal","md","ellipsis-vertical"],[1,"create-form-content"],["lines","none",1,"ion-no-margin",2,"margin","-15px auto"],["name","map-outline",2,"zoom","0.7"],[1,"ion-text-wrap"],["target","_blank",3,"href",4,"ngIf"],[1,"date"],["color","secondary",4,"ngIf"],["color","danger",4,"ngIf"],[1,"ion-padding","ion-no-margin"],[4,"ngIf"],["color","secondary"],["name","person-circle","color","primary",2,"zoom","0.7"],["color","secondary","expand","block",3,"title","click",4,"ngIf"],[1,"user-details-fields","fields-section"],[4,"ngIf","ngIfElse"],["loading",""],[1,"form-actions-wrapper"],["color","primary","expand","block","fill","outline","type","submit",3,"hidden","click",4,"ngIf"],["slot","icon-only","name","caret-forward-circle-outline"],["slot","icon-only","name","save-outline"],["slot","icon-only","name","print-outline"],["slot","icon-only","name","download-outline"],["slot","icon-only","ios","trending-up-outline","md","trending-up-outline"],["target","_blank",3,"href"],["color","danger"],["color","secondary","expand","block",3,"title","click"],[3,"controls","form"],["dynamicForm","dynamicForm"],[1,"loading"],["color","primary","expand","block","fill","outline","type","submit",3,"hidden","click"]],template:function(e,a){if(1&e&&(t.TgZ(0,"ion-header"),t.TgZ(1,"ion-toolbar",0),t.TgZ(2,"ion-buttons",1),t.TgZ(3,"ion-button",2),t.NdJ("click",function(){return a.back()}),t._UZ(4,"ion-icon",3),t.qZA(),t.qZA(),t._UZ(5,"ion-title",4),t.TgZ(6,"ion-buttons",5),t.YNc(7,it,3,3,"ion-button",6),t.YNc(8,et,3,3,"ion-button",6),t.TgZ(9,"ion-buttons",7),t.YNc(10,at,3,3,"ion-button",6),t.qZA(),t.TgZ(11,"ion-buttons",7),t.YNc(12,ot,3,3,"ion-button",6),t.qZA(),t.TgZ(13,"ion-buttons",7),t.YNc(14,rt,3,3,"ion-button",6),t.qZA(),t.YNc(15,st,3,3,"ion-button",6),t.TgZ(16,"ion-button",8),t.NdJ("click",function(o){return a.presentPopover(o)}),t.ALo(17,"translate"),t._UZ(18,"ion-icon",9),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(19,"ion-content",10),t._UZ(20,"br"),t.TgZ(21,"ion-item",11),t._UZ(22,"ion-icon",12),t.TgZ(23,"ion-label",13),t.TgZ(24,"h2"),t.YNc(25,nt,3,5,"a",14),t.TgZ(26,"span",15),t.TgZ(27,"ion-note"),t.TgZ(28,"ion-chip"),t.YNc(29,ct,2,1,"ion-label",16),t.YNc(30,lt,2,1,"ion-label",17),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(31,"div",18),t.YNc(32,dt,3,5,"h2",19),t.YNc(33,ut,3,5,"h2",19),t.TgZ(34,"ion-text",20),t._uU(35),t.ALo(36,"translate"),t._UZ(37,"br"),t._uU(38),t.ALo(39,"translate"),t.ALo(40,"date"),t._UZ(41,"br"),t._uU(42),t.ALo(43,"translate"),t.ALo(44,"date"),t._UZ(45,"br"),t.qZA(),t.qZA(),t.TgZ(46,"ion-item"),t._UZ(47,"ion-icon",21),t.TgZ(48,"ion-label",13),t.TgZ(49,"h2"),t._uU(50),t.ALo(51,"translate"),t.TgZ(52,"span",15),t.TgZ(53,"ion-note"),t._uU(54),t.ALo(55,"date"),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.YNc(56,ht,4,6,"ion-button",22),t.TgZ(57,"section",23),t.YNc(58,mt,3,2,"div",24),t.YNc(59,pt,3,3,"ng-template",null,25,t.W1O),t.qZA(),t.qZA(),t.TgZ(61,"ion-footer"),t.TgZ(62,"ion-row",26),t.TgZ(63,"ion-col"),t.YNc(64,ft,3,4,"ion-button",27),t.qZA(),t.qZA(),t.qZA()),2&e){const i=t.MAs(60);t.xp6(7),t.Q6J("ngIf",0!==a.comandos.length&&"activo"==a.dataitem.estadointerno),t.xp6(1),t.Q6J("ngIf","activo"==a.dataitem.estadointerno),t.xp6(2),t.Q6J("ngIf","true"===a.variables.imprimeorden),t.xp6(2),t.Q6J("ngIf","false"===a.variables.imprimeorden),t.xp6(2),t.Q6J("ngIf","true"===a.variables.imprimeorden2),t.xp6(1),t.Q6J("ngIf","true"===a.permisosorden.trayectoriaorden),t.xp6(1),t.MGl("title"," ",t.lcZ(17,27,"opciones"),""),t.xp6(9),t.Q6J("ngIf",void 0!==a.dataitem.geoposicionxxx&&""!==a.dataitem.geoposicionxxx),t.xp6(4),t.Q6J("ngIf","activo"==a.dataitem.estadointerno),t.xp6(1),t.Q6J("ngIf","activo"!==a.dataitem.estadointerno),t.xp6(2),t.Q6J("ngIf","Si"===a.userinfo[0].idempresa.sicorrelativo),t.xp6(1),t.Q6J("ngIf","No"===a.userinfo[0].idempresa.sicorrelativo),t.xp6(2),t.AsE(" ",t.lcZ(36,29,"ultima_act"),": ",a.dataitem.estadoxxx,""),t.xp6(3),t.lnq(" ",t.lcZ(39,31,"creacion"),": <",t.xi3(40,33,a.dataitem.createdAt,"dd-MM-yyyy h:mm a"),", ",a.dataitem.usuarionew2,"> "),t.xp6(4),t.lnq(" ",t.lcZ(43,36,"estado_actual"),": <",t.xi3(44,38,a.dataitem.updatedAt,"dd-MM-yyyy h:mm a"),", ",a.dataitem.usuarioup2,"> "),t.xp6(8),t.AsE(" ",t.lcZ(51,41,"envio")," : ",a.dataitem.enviadoporxxx," "),t.xp6(4),t.Oqu(t.xi3(55,43,a.dataitem.updatedAt,"dd-MM-yyyy h:mm a")),t.xp6(2),t.Q6J("ngIf",1===a.tienedetalle),t.xp6(2),t.Q6J("ngIf",a.controls)("ngIfElse",i),t.xp6(6),t.Q6J("ngIf","true"===a.permisosorden.acciones&&"activo"==a.dataitem.estadointerno)}},directives:[S.Gu,S.sr,S.Sm,S.YG,S.gu,S.wd,T.O5,S.W2,S.Ie,S.Q$,S.uN,S.hM,S.yW,S.fr,S.Nd,S.wI,X.r],pipes:[E.X$,T.uU],styles:["[_nghost-%COMP%]{--page-margin: var(--app-fair-margin);--page-background: var(--app-background);--page-background-shade: var(--app-background-shade);--page-tags-gutter: 5px}element.style[_ngcontent-%COMP%]{margin:-25px auto}.loading[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:100%;font-size:x-large}ion-item[_ngcontent-%COMP%]{--inner-padding-end: 0;--background: transparent;padding-top:0;padding-bottom:0}.ion-padding[_ngcontent-%COMP%]{padding-top:0;padding-bottom:0}ion-item[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-weight:600}ion-item[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{float:right;align-items:center;display:flex}ion-item[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:42px;margin-right:8px}ion-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{font-size:15px;margin-right:12px;font-weight:400}.dot[_ngcontent-%COMP%]{display:block;height:12px;width:12px;border-radius:50%;align-self:start;margin:16px 10px 16px 16px}.dot-unread[_ngcontent-%COMP%]{background:var(--ion-color-primary)}h1[_ngcontent-%COMP%]{margin:0;font-weight:700;font-size:22px}p[_ngcontent-%COMP%]{line-height:22px}.show-favorite[_ngcontent-%COMP%]{position:relative}.icon-heart-empty[_ngcontent-%COMP%], .icon-heart[_ngcontent-%COMP%]{--border-radius: 50%;--padding-start: 0;--padding-end: 0;position:absolute;top:5px;right:5px;width:48px;height:48px;font-size:16px;transition:transform .3s ease}.icon-heart-empty[_ngcontent-%COMP%]{transform:scale(1)}.icon-heart[_ngcontent-%COMP%]{transform:scale(0)}.show-favorite[_ngcontent-%COMP%]   .icon-heart[_ngcontent-%COMP%]{transform:scale(1)}.show-favorite[_ngcontent-%COMP%]   .icon-heart-empty[_ngcontent-%COMP%]{transform:scale(0)}h1[_ngcontent-%COMP%]{margin:0}"]}),h})(),vt=(()=>{class h{}return h.\u0275fac=function(e){return new(e||h)},h.\u0275mod=t.oAB({type:h}),h.\u0275inj=t.cJS({imports:[[T.ez,S.Pc,O.K,j.u5,j.UX,M.YL,w.N,z.YZ,k.Bz.forChild([{path:"",component:gt}]),E.aw.forChild()]]}),h})()},22675:(D,N,x)=>{x.d(N,{v:()=>w});var S=x(69808),k=x(93075),T=x(51062),O=x(23349),E=x(55787),j=x(56604),M=x(5e3);let w=(()=>{class z{}return z.\u0275fac=function(U){return new(U||z)},z.\u0275mod=M.oAB({type:z}),z.\u0275inj=M.cJS({imports:[[S.ez,k.u5,k.UX,O.Pc,E.Bz,j.Cl,T.aw.forChild()]]}),z})()}}]);